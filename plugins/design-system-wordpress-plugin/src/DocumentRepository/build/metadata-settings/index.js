(()=>{"use strict";var e={n:s=>{var i=s&&s.__esModule?()=>s.default:()=>s;return e.d(i,{a:i}),i},d:(s,i)=>{for(var l in i)e.o(i,l)&&!e.o(s,l)&&Object.defineProperty(s,l,{enumerable:!0,get:i[l]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.wp.element,i=window.wp.components,l=window.wp.i18n,a=window.ReactJSXRuntime,t=({title:e,isOpen:t,onClose:d,onSave:n,isSaving:o=!1,isDisabled:r=!1,saveButtonText:c,saveButtonClassName:m="doc-repo-button save-button",children:g})=>{const b=(0,s.useCallback)((e=>{e&&(e.preventDefault(),e.stopPropagation()),d()}),[d]),p=(0,s.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),n()}),[n]);return t?(0,a.jsx)(i.Modal,{title:e,onRequestClose:b,className:"metadata-edit-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0,children:(0,a.jsxs)("form",{onSubmit:p,className:"metadata-edit-form",children:[g,(0,a.jsxs)("div",{className:"modal-actions",children:[(0,a.jsx)(i.Button,{onClick:b,disabled:o,className:"doc-repo-button cancel-button",children:(0,l.__)("Cancel","bcgov-design-system")}),(0,a.jsx)(i.Button,{type:"submit",isBusy:o,disabled:o||r,className:m,children:c||(0,l.__)("Save Changes","bcgov-design-system")})]})]})}):null},d=(0,s.forwardRef)((function({icon:e,size:i=24,...l},a){return(0,s.cloneElement)(e,{width:i,height:i,...l,ref:a})})),n=window.wp.primitives,o=(0,a.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,a.jsx)(n.Path,{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM12.75 8V13H11.25V8H12.75ZM12.75 14.5V16H11.25V14.5H12.75Z"})}),r=({isOpen:e,onClose:s,onConfirm:t,field:n,isDeleting:r})=>e&&n?(0,a.jsx)(i.Modal,{title:(0,l.__)("Delete Metadata Field","bcgov-design-system"),onRequestClose:s,className:"metadata-field-modal",children:(0,a.jsxs)("div",{className:"document-delete-form",children:[(0,a.jsxs)("div",{className:"delete-warning",children:[(0,a.jsx)("div",{className:"warning-icon",children:(0,a.jsx)(d,{icon:o})}),(0,a.jsxs)("div",{className:"warning-content",children:[(0,a.jsx)("strong",{children:(0,l.__)("This action cannot be undone","bcgov-design-system")}),(0,a.jsx)("p",{children:(0,l.__)("Deleting this field will permanently remove it and its values from all documents in the repository.","bcgov-design-system")})]})]}),(0,a.jsxs)("div",{className:"document-info",children:[(0,a.jsx)("h3",{children:(0,l.__)("Field Information","bcgov-design-system")}),(0,a.jsxs)("div",{className:"info-grid",children:[(0,a.jsx)("div",{className:"label",children:(0,l.__)("Field ID:","bcgov-design-system")}),(0,a.jsx)("div",{className:"value",children:n.id}),(0,a.jsx)("div",{className:"label",children:(0,l.__)("Label:","bcgov-design-system")}),(0,a.jsx)("div",{className:"value",children:n.label}),(0,a.jsx)("div",{className:"label",children:(0,l.__)("Type:","bcgov-design-system")}),(0,a.jsx)("div",{className:"value",children:n.type})]})]}),(0,a.jsxs)("div",{className:"delete-actions",children:[(0,a.jsx)(i.Button,{onClick:s,className:"doc-repo-button cancel-button",disabled:r,children:(0,l.__)("Cancel","bcgov-design-system")}),(0,a.jsx)(i.Button,{onClick:t,className:"doc-repo-button delete-button",disabled:r,children:r?(0,l.__)("Deleting…","bcgov-design-system"):(0,l.__)("Delete Field","bcgov-design-system")})]})]})}):null,c=({children:e})=>(0,a.jsx)("div",{className:"metadata-fields-list",children:e}),m=({children:e})=>(0,a.jsx)("div",{className:"metadata-field-item",children:(0,a.jsx)("div",{className:"metadata-field-info",children:e})}),g={text:(0,l.__)("Text","bcgov-design-system"),select:(0,l.__)("Select","bcgov-design-system"),date:(0,l.__)("Date","bcgov-design-system")},b=({fields:e,onEdit:s,onDelete:t,isSaving:d})=>0===e.length?(0,a.jsx)("div",{className:"no-fields-message",children:(0,a.jsx)("p",{children:(0,l.__)('No custom metadata fields defined yet. Click "Add New Field" to create one.',"bcgov-design-system")})}):(0,a.jsx)(c,{children:e.map(((e,n)=>(0,a.jsxs)(m,{children:[(0,a.jsxs)("div",{className:"metadata-field-info",children:[(0,a.jsx)("h3",{children:e.label}),(0,a.jsxs)("p",{className:"field-id",children:["ID: ",e.id]}),(0,a.jsxs)("p",{className:"field-type",children:["Type: ",g[e.type]]})]}),(0,a.jsxs)("div",{className:"metadata-field-actions",children:[(0,a.jsx)(i.Button,{className:"doc-repo-button edit-button",onClick:()=>s(e,n),children:(0,l.__)("Edit","bcgov-design-system")}),(0,a.jsx)(i.Button,{className:"doc-repo-button delete-button",onClick:()=>t(e),disabled:d,children:(0,l.__)("Delete","bcgov-design-system")})]})]},e.id)))}),p={text:(0,l.__)("Text","bcgov-design-system"),select:(0,l.__)("Select","bcgov-design-system"),date:(0,l.__)("Date","bcgov-design-system")},u=({field:e,errors:s,onChange:t,onOptionsChange:d,isEdit:n=!1})=>{return(0,a.jsxs)("div",{className:"metadata-field-form",children:[s?.submit&&(0,a.jsx)(i.Notice,{status:"error",isDismissible:!1,children:(0,a.jsx)("p",{children:s.submit})}),(0,a.jsx)(i.TextControl,{label:(0,l.__)("Field Label","bcgov-design-system"),help:(0,l.__)("Display name for the field","bcgov-design-system"),value:e.label,onChange:e=>t("label",e),required:!0,className:s?.label?"has-error":""}),s?.label&&(0,a.jsx)("div",{className:"field-error",children:s.label}),n?(0,a.jsxs)("div",{className:"field-type-display",children:[(0,a.jsx)("label",{htmlFor:"edit-field-type-value",children:(0,l.__)("Field Type","bcgov-design-system")}),(0,a.jsx)("div",{id:"edit-field-type-value",className:"field-type-value",children:p[e.type]})]}):(0,a.jsx)(i.SelectControl,{label:(0,l.__)("Field Type","bcgov-design-system"),value:e.type,options:Object.entries(p).map((([e,s])=>({value:e,label:s}))),onChange:e=>t("type",e)}),"select"===e.type&&(0,a.jsx)(i.TextareaControl,{label:(0,l.__)("Options","bcgov-design-system"),value:(o=e,void 0!==o._rawOptionsText?o._rawOptionsText:Array.isArray(o.options)?o.options.join("\n"):""),onChange:d,help:(0,l.__)("Enter one option per line","bcgov-design-system")})]});var o},v=window.wp.apiFetch;var h=e.n(v);const f=()=>{const{state:e,setState:d,fetchFields:n,saveFields:o,validateField:c,getInitialFieldState:m}=(()=>{const[e,i]=(0,s.useState)({fields:[],isLoading:!0,error:null,isSaving:!1,modals:{add:{isOpen:!1,field:{id:"",label:"",type:"text",options:[],_rawOptionsText:""},errors:{label:"",submit:""}},edit:{isOpen:!1,field:null,index:null,errors:{label:"",submit:""},originalValues:null},delete:{isOpen:!1,field:null}}}),{apiNamespace:a}=window.documentRepositorySettings,t=(0,s.useCallback)((async()=>{try{const e=await h()({path:`/${a}/metadata-fields`});return i((s=>({...s,fields:e,error:null,isLoading:!1}))),{success:!0,data:e}}catch(e){return i((s=>({...s,error:e.message||(0,l.__)("Error loading metadata fields","bcgov-design-system"),isLoading:!1}))),{success:!1,error:e.message||(0,l.__)("Error loading metadata fields","bcgov-design-system")}}}),[a]),d=(0,s.useCallback)((async e=>{try{return await h()({path:`/${a}/metadata-fields`,method:"PUT",data:{fields:e}}),{success:!0}}catch(e){return{success:!1,error:e.message||(0,l.__)("Error saving metadata fields","bcgov-design-system")}}}),[a]),n=(0,s.useCallback)(((e,s=[],i=null)=>{const a={};return e.id||(a.id=(0,l.__)("Field ID is required","bcgov-design-system")),e.label||(a.label=(0,l.__)("Field label is required","bcgov-design-system")),s.some(((s,l)=>l!==i&&s.label.toLowerCase()===e.label.toLowerCase()))&&(a.label=(0,l.__)("A field with this label already exists","bcgov-design-system")),s.some(((s,l)=>l!==i&&s.id===e.id))&&(a.id=(0,l.__)("A field with this ID already exists","bcgov-design-system")),"select"!==e.type||e.options&&0!==e.options.length||(a.options=(0,l.__)("Select fields require at least one option","bcgov-design-system")),a}),[]),o=(0,s.useCallback)((()=>({id:"",label:"",type:"text",options:[],_rawOptionsText:""})),[]);return{state:e,setState:i,fetchFields:t,saveFields:d,validateField:n,getInitialFieldState:o}})(),[g,p]=(0,s.useState)(!1),v=(0,s.useCallback)((e=>Array.isArray(e)?e.map((e=>String(e).trim())).filter((e=>e.length>0)):[]),[]),f=(0,s.useCallback)((e=>void 0!==e._rawOptionsText?e._rawOptionsText:Array.isArray(e.options)?e.options.join("\n"):""),[]);(0,s.useEffect)((()=>{n()}),[n]);const _=(0,s.useCallback)(((e,s,i)=>{d((l=>{const a=l.modals[e].field;let t={[s]:i};if("label"===s){const e=`${i.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${a.type.toLowerCase()}`;t={...t,id:e}}if("type"===s){const e=`${a.label?.toLowerCase().replace(/[^a-z0-9]+/g,"_")||""}_${i.toLowerCase()}`;t={...t,id:e}}const d={...a,...t},n=l.modals[e]?.originalValues;let o=!1;return n&&(n.label!==d.label||n.type!==d.type||n._rawOptionsText!==d._rawOptionsText)&&(o=!0),p(o),{...l,modals:{...l.modals,[e]:{...l.modals[e],field:d}}}}),[d])}),[d]),y=(0,s.useCallback)(((e,s)=>{const i=e.split("\n").map((e=>e.trim())).filter((e=>e.length>0));d((l=>{const a={...l.modals[s].field,_rawOptionsText:e,options:i},t=l.modals[s]?.originalValues;let d=!1;return t&&(t.label!==a.label||t.type!==a.type||t._rawOptionsText!==a._rawOptionsText)&&(d=!0),p(d),{...l,modals:{...l.modals,[s]:{...l.modals[s],field:a}}}}),[d])}),[d]),x=(0,s.useCallback)((async()=>{const{field:s}=e.modals.add,i=c(s,e.fields);if(Object.keys(i).length>0)d((e=>({...e,modals:{...e.modals,add:{...e.modals.add,errors:i}}})));else{d((e=>({...e,isSaving:!0})));try{const i=await o([...e.fields,{...s,order:e.fields.length}]);i.success?d((e=>({...e,fields:[...e.fields,{...s,order:e.fields.length}],isSaving:!1,modals:{...e.modals,add:{isOpen:!1,field:m(),errors:{label:"",submit:""}}}}))):d((e=>({...e,isSaving:!1,modals:{...e.modals,add:{...e.modals.add,errors:{submit:i.error||(0,l.__)("Failed to save field","bcgov-design-system")}}}})))}catch(e){d((s=>({...s,isSaving:!1,modals:{...s.modals,add:{...s.modals.add,errors:{submit:e.message||(0,l.__)("Failed to save field","bcgov-design-system")}}}})))}}}),[e.fields,e.modals.add,o,c,m,d]),j=(0,s.useCallback)(((e,s)=>{const i={label:e.label||"",type:e.type||"",options:v(e.options),_rawOptionsText:e._rawOptionsText||f(e),id:e.id||""};d((l=>({...l,modals:{...l.modals,edit:{isOpen:!0,field:{...e},index:s,originalValues:i,errors:{label:"",submit:""}}}}))),p(!1)}),[v,f,d]),w=(0,s.useCallback)((async()=>{const{field:s,index:i}=e.modals.edit,l=c(s,e.fields,i);if(Object.keys(l).length>0)return void d((e=>({...e,error:l})));d((e=>({...e,isSaving:!0})));const a=await o([...e.fields.slice(0,i),s,...e.fields.slice(i+1)]);a.success?d((l=>({...l,fields:[...e.fields.slice(0,i),s,...e.fields.slice(i+1)],error:null,isSaving:!1,modals:{...l.modals,edit:{isOpen:!1,field:null,index:null,originalValues:null}}}))):d((e=>({...e,error:a.error,isSaving:!1})))}),[e.fields,e.modals.edit,o,c,d]),C=(0,s.useCallback)((e=>{d((s=>({...s,modals:{...s.modals,delete:{isOpen:!0,field:e}}})))}),[d]),N=(0,s.useCallback)((async()=>{const s=e.modals.delete.field.id;d((e=>({...e,isSaving:!0})));try{await h()({path:`/${window.documentRepositorySettings.apiNamespace}/metadata-fields/${s}/cleanup`,method:"DELETE"});const i=e.fields.filter((e=>e.id!==s)),l=await o(i);l.success?d((e=>({...e,fields:i,isSaving:!1,error:null,modals:{...e.modals,delete:{isOpen:!1,field:null}}}))):d((e=>({...e,error:l.error,isSaving:!1})))}catch(e){d((s=>({...s,error:e.message||(0,l.__)("Error deleting metadata field","bcgov-design-system"),isSaving:!1})))}}),[e.fields,e.modals.delete.field,o,d]),O=(0,s.useCallback)((()=>{d((e=>({...e,modals:{...e.modals,delete:{isOpen:!1,field:null}}})))}),[d]),S=(0,s.useCallback)((e=>{d((s=>({...s,modals:{...s.modals,[e]:{...s.modals[e],isOpen:!1,field:m(),errors:{label:"",submit:""},originalValues:null}}}))),p(!1)}),[m,d]);return e.isLoading?(0,a.jsx)("div",{className:"dswp-document-metadata-settings",children:(0,a.jsxs)("div",{className:"metadata-settings-loading",children:[(0,a.jsx)("div",{className:"spinner-wrapper",children:(0,a.jsx)("div",{className:"components-spinner"})}),(0,a.jsx)("p",{children:(0,l.__)("Loading metadata fields…","bcgov-design-system")})]})}):(0,a.jsx)("div",{className:"dswp-document-metadata-settings",children:(0,a.jsxs)("div",{className:"metadata-settings",children:[e.error&&(0,a.jsx)(i.Notice,{status:"error",isDismissible:!1,children:(0,a.jsx)("p",{children:e.error})}),(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsx)("h2",{children:(0,l.__)("Document Metadata Fields","bcgov-design-system")}),(0,a.jsx)(i.Button,{className:"doc-repo-button save-button",onClick:()=>d((e=>({...e,modals:{...e.modals,add:{isOpen:!0,field:m(),errors:{label:"",submit:""}}}}))),disabled:e.isSaving,children:(0,l.__)("Add New Field","bcgov-design-system")})]}),(0,a.jsxs)(i.CardBody,{children:[(0,a.jsx)("div",{className:"metadata-fields-info",children:(0,a.jsx)("p",{children:(0,l.__)("Customize the metadata fields that will be available for documents.","bcgov-design-system")})}),(0,a.jsx)(b,{fields:e.fields,onEdit:j,onDelete:C,isSaving:e.isSaving})]})]}),(0,a.jsx)(t,{title:(0,l.__)("Edit Metadata Field","bcgov-design-system"),isOpen:e.modals.edit.isOpen,onClose:()=>S("edit"),onSave:w,isSaving:e.isSaving,isDisabled:!g||!e.modals.edit.field?.label,children:(0,a.jsx)(u,{field:e.modals.edit.field,errors:e.modals.edit.errors,onChange:(e,s)=>_("edit",e,s),onOptionsChange:e=>y(e,"edit"),isEdit:!0})}),(0,a.jsx)(t,{title:(0,l.__)("Add New Metadata Field","bcgov-design-system"),isOpen:e.modals.add.isOpen,onClose:()=>S("add"),onSave:x,isSaving:e.isSaving,isDisabled:!e.modals.add.field.label,children:(0,a.jsx)(u,{field:e.modals.add.field,errors:e.modals.add.errors,onChange:(e,s)=>_("add",e,s),onOptionsChange:e=>y(e,"add"),isEdit:!1})}),(0,a.jsx)(r,{isOpen:e.modals.delete.isOpen,onClose:O,onConfirm:N,field:e.modals.delete.field,isDeleting:e.isSaving})]})})};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("dswp-document-repository-metadata-app");if(e)try{(0,s.render)((0,a.jsx)(f,{}),e)}catch(s){e.innerHTML='<div class="notice notice-error"><p>Error initializing metadata settings. Please check the console for details.</p></div>'}}))})();