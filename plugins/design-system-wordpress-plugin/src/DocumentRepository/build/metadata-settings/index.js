(()=>{"use strict";var e={20:(e,t,s)=>{var a=s(609),l=Symbol.for("react.element"),i=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),n=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,s){var a,o={},r=null,c=null;for(a in void 0!==s&&(r=""+s),void 0!==t.key&&(r=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,a)&&!d.hasOwnProperty(a)&&(o[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===o[a]&&(o[a]=t[a]);return{$$typeof:l,type:e,key:r,ref:c,props:o,_owner:n.current}}},609:e=>{e.exports=window.React},848:(e,t,s)=>{e.exports=s(20)}},t={};function s(a){var l=t[a];if(void 0!==l)return l.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a=s(609);const l=window.wp.element,i=window.wp.components,n=window.wp.i18n,d=({title:e,isOpen:t,onClose:s,onSave:d,isSaving:o=!1,isDisabled:r=!1,saveButtonText:c,saveButtonClassName:m="doc-repo-button save-button",children:g})=>{const u=(0,l.useCallback)((e=>{e&&(e.preventDefault(),e.stopPropagation()),s()}),[s]),p=(0,l.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),d()}),[d]);return t?(0,a.createElement)(i.Modal,{title:e,onRequestClose:u,className:"metadata-edit-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0},(0,a.createElement)("form",{onSubmit:p,className:"metadata-edit-form"},g,(0,a.createElement)("div",{className:"modal-actions"},(0,a.createElement)(i.Button,{onClick:u,disabled:o,className:"doc-repo-button cancel-button"},(0,n.__)("Cancel","bcgov-design-system")),(0,a.createElement)(i.Button,{type:"submit",isBusy:o,disabled:o||r,className:m},c||(0,n.__)("Save Changes","bcgov-design-system"))))):null},o=(0,l.forwardRef)((function({icon:e,size:t=24,...s},a){return(0,l.cloneElement)(e,{width:t,height:t,...s,ref:a})})),r=window.wp.primitives;var c=s(848);const m=(0,c.jsx)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,c.jsx)(r.Path,{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM12.75 8V13H11.25V8H12.75ZM12.75 14.5V16H11.25V14.5H12.75Z"})}),g=({isOpen:e,onClose:t,onConfirm:s,field:l,isDeleting:d})=>e&&l?(0,a.createElement)(i.Modal,{title:(0,n.__)("Delete Metadata Field","bcgov-design-system"),onRequestClose:t,className:"metadata-field-modal"},(0,a.createElement)("div",{className:"document-delete-form"},(0,a.createElement)("div",{className:"delete-warning"},(0,a.createElement)("div",{className:"warning-icon"},(0,a.createElement)(o,{icon:m})),(0,a.createElement)("div",{className:"warning-content"},(0,a.createElement)("strong",null,(0,n.__)("This action cannot be undone","bcgov-design-system")),(0,a.createElement)("p",null,(0,n.__)("Deleting this field will permanently remove it and its values from all documents in the repository.","bcgov-design-system")))),(0,a.createElement)("div",{className:"document-info"},(0,a.createElement)("h3",null,(0,n.__)("Field Information","bcgov-design-system")),(0,a.createElement)("div",{className:"info-grid"},(0,a.createElement)("div",{className:"label"},(0,n.__)("Field ID:","bcgov-design-system")),(0,a.createElement)("div",{className:"value"},l.id),(0,a.createElement)("div",{className:"label"},(0,n.__)("Label:","bcgov-design-system")),(0,a.createElement)("div",{className:"value"},l.label),(0,a.createElement)("div",{className:"label"},(0,n.__)("Type:","bcgov-design-system")),(0,a.createElement)("div",{className:"value"},l.type))),(0,a.createElement)("div",{className:"delete-actions"},(0,a.createElement)(i.Button,{onClick:t,className:"doc-repo-button cancel-button",disabled:d},(0,n.__)("Cancel","bcgov-design-system")),(0,a.createElement)(i.Button,{onClick:s,className:"doc-repo-button delete-button",disabled:d},d?(0,n.__)("Deleting…","bcgov-design-system"):(0,n.__)("Delete Field","bcgov-design-system"))))):null,u=({children:e})=>(0,a.createElement)("div",{className:"metadata-fields-list"},e),p=({children:e})=>(0,a.createElement)("div",{className:"metadata-field-item"},(0,a.createElement)("div",{className:"metadata-field-info"},e)),b={text:(0,n.__)("Text","bcgov-design-system"),select:(0,n.__)("Select","bcgov-design-system"),date:(0,n.__)("Date","bcgov-design-system")},v=({fields:e,onEdit:t,onDelete:s,isSaving:l})=>0===e.length?(0,a.createElement)("div",{className:"no-fields-message"},(0,a.createElement)("p",null,(0,n.__)('No custom metadata fields defined yet. Click "Add New Field" to create one.',"bcgov-design-system"))):(0,a.createElement)(u,null,e.map(((e,d)=>(0,a.createElement)(p,{key:e.id},(0,a.createElement)("div",{className:"metadata-field-info"},(0,a.createElement)("h3",null,e.label),(0,a.createElement)("p",{className:"field-id"},"ID: ",e.id),(0,a.createElement)("p",{className:"field-type"},"Type: ",b[e.type])),(0,a.createElement)("div",{className:"metadata-field-actions"},(0,a.createElement)(i.Button,{className:"doc-repo-button edit-button",onClick:()=>t(e,d)},(0,n.__)("Edit","bcgov-design-system")),(0,a.createElement)(i.Button,{className:"doc-repo-button delete-button",onClick:()=>s(e),disabled:l},(0,n.__)("Delete","bcgov-design-system"))))))),f={text:(0,n.__)("Text","bcgov-design-system"),select:(0,n.__)("Select","bcgov-design-system"),date:(0,n.__)("Date","bcgov-design-system")},_=({field:e,errors:t,onChange:s,onOptionsChange:l,isEdit:d=!1})=>{return(0,a.createElement)("div",{className:"metadata-field-form"},t?.submit&&(0,a.createElement)(i.Notice,{status:"error",isDismissible:!1},(0,a.createElement)("p",null,t.submit)),(0,a.createElement)(i.TextControl,{label:(0,n.__)("Field Label","bcgov-design-system"),help:(0,n.__)("Display name for the field","bcgov-design-system"),value:e.label,onChange:e=>s("label",e),required:!0,className:t?.label?"has-error":""}),t?.label&&(0,a.createElement)("div",{className:"field-error"},t.label),d?(0,a.createElement)("div",{className:"field-type-display"},(0,a.createElement)("label",{htmlFor:"edit-field-type-value"},(0,n.__)("Field Type","bcgov-design-system")),(0,a.createElement)("div",{id:"edit-field-type-value",className:"field-type-value"},f[e.type])):(0,a.createElement)(i.SelectControl,{label:(0,n.__)("Field Type","bcgov-design-system"),value:e.type,options:Object.entries(f).map((([e,t])=>({value:e,label:t}))),onChange:e=>s("type",e)}),"select"===e.type&&(0,a.createElement)(i.TextareaControl,{label:(0,n.__)("Options","bcgov-design-system"),value:(o=e,void 0!==o._rawOptionsText?o._rawOptionsText:Array.isArray(o.options)?o.options.join("\n"):""),onChange:l,help:(0,n.__)("Enter one option per line","bcgov-design-system")}));var o},y=window.wp.apiFetch;var E=s.n(y);const w=()=>{const{state:e,setState:t,fetchFields:s,saveFields:o,validateField:r,getInitialFieldState:c}=(()=>{const[e,t]=(0,l.useState)({fields:[],isLoading:!0,error:null,isSaving:!1,modals:{add:{isOpen:!1,field:{id:"",label:"",type:"text",options:[],_rawOptionsText:""},errors:{label:"",submit:""}},edit:{isOpen:!1,field:null,index:null,errors:{label:"",submit:""},originalValues:null},delete:{isOpen:!1,field:null}}}),{apiNamespace:s}=window.documentRepositorySettings,a=(0,l.useCallback)((async()=>{try{const e=await E()({path:`/${s}/metadata-fields`});return t((t=>({...t,fields:e,error:null,isLoading:!1}))),{success:!0,data:e}}catch(e){return t((t=>({...t,error:e.message||(0,n.__)("Error loading metadata fields","bcgov-design-system"),isLoading:!1}))),{success:!1,error:e.message||(0,n.__)("Error loading metadata fields","bcgov-design-system")}}}),[s]),i=(0,l.useCallback)((async e=>{try{return await E()({path:`/${s}/metadata-fields`,method:"PUT",data:{fields:e}}),{success:!0}}catch(e){return{success:!1,error:e.message||(0,n.__)("Error saving metadata fields","bcgov-design-system")}}}),[s]),d=(0,l.useCallback)(((e,t=[],s=null)=>{const a={};return e.id||(a.id=(0,n.__)("Field ID is required","bcgov-design-system")),e.label||(a.label=(0,n.__)("Field label is required","bcgov-design-system")),t.some(((t,a)=>a!==s&&t.label.toLowerCase()===e.label.toLowerCase()))&&(a.label=(0,n.__)("A field with this label already exists","bcgov-design-system")),t.some(((t,a)=>a!==s&&t.id===e.id))&&(a.id=(0,n.__)("A field with this ID already exists","bcgov-design-system")),"select"!==e.type||e.options&&0!==e.options.length||(a.options=(0,n.__)("Select fields require at least one option","bcgov-design-system")),a}),[]),o=(0,l.useCallback)((()=>({id:"",label:"",type:"text",options:[],_rawOptionsText:""})),[]);return{state:e,setState:t,fetchFields:a,saveFields:i,validateField:d,getInitialFieldState:o}})(),[m,u]=(0,l.useState)(!1),p=(0,l.useCallback)((e=>Array.isArray(e)?e.map((e=>String(e).trim())).filter((e=>e.length>0)):[]),[]),b=(0,l.useCallback)((e=>void 0!==e._rawOptionsText?e._rawOptionsText:Array.isArray(e.options)?e.options.join("\n"):""),[]);(0,l.useEffect)((()=>{s()}),[s]);const f=(0,l.useCallback)(((e,s,a)=>{t((t=>{const l=t.modals[e].field;let i={[s]:a};if("label"===s){const e=`${a.toLowerCase().replace(/[^a-z0-9]+/g,"_")}_${l.type.toLowerCase()}`;i={...i,id:e}}if("type"===s){const e=`${l.label?.toLowerCase().replace(/[^a-z0-9]+/g,"_")||""}_${a.toLowerCase()}`;i={...i,id:e}}const n={...l,...i},d=t.modals[e]?.originalValues;let o=!1;return d&&(d.label!==n.label||d.type!==n.type||d._rawOptionsText!==n._rawOptionsText)&&(o=!0),u(o),{...t,modals:{...t.modals,[e]:{...t.modals[e],field:n}}}}),[t])}),[t]),y=(0,l.useCallback)(((e,s)=>{const a=e.split("\n").map((e=>e.trim())).filter((e=>e.length>0));t((t=>{const l={...t.modals[s].field,_rawOptionsText:e,options:a},i=t.modals[s]?.originalValues;let n=!1;return i&&(i.label!==l.label||i.type!==l.type||i._rawOptionsText!==l._rawOptionsText)&&(n=!0),u(n),{...t,modals:{...t.modals,[s]:{...t.modals[s],field:l}}}}),[t])}),[t]),w=(0,l.useCallback)((async()=>{const{field:s}=e.modals.add,a=r(s,e.fields);if(Object.keys(a).length>0)t((e=>({...e,modals:{...e.modals,add:{...e.modals.add,errors:a}}})));else{t((e=>({...e,isSaving:!0})));try{const a=await o([...e.fields,{...s,order:e.fields.length}]);a.success?t((e=>({...e,fields:[...e.fields,{...s,order:e.fields.length}],isSaving:!1,modals:{...e.modals,add:{isOpen:!1,field:c(),errors:{label:"",submit:""}}}}))):t((e=>({...e,isSaving:!1,modals:{...e.modals,add:{...e.modals.add,errors:{submit:a.error||(0,n.__)("Failed to save field","bcgov-design-system")}}}})))}catch(e){t((t=>({...t,isSaving:!1,modals:{...t.modals,add:{...t.modals.add,errors:{submit:e.message||(0,n.__)("Failed to save field","bcgov-design-system")}}}})))}}}),[e.fields,e.modals.add,o,r,c,t]),C=(0,l.useCallback)(((e,s)=>{const a={label:e.label||"",type:e.type||"",options:p(e.options),_rawOptionsText:e._rawOptionsText||b(e),id:e.id||""};t((t=>({...t,modals:{...t.modals,edit:{isOpen:!0,field:{...e},index:s,originalValues:a,errors:{label:"",submit:""}}}}))),u(!1)}),[p,b,t]),h=(0,l.useCallback)((async()=>{const{field:s,index:a}=e.modals.edit,l=r(s,e.fields,a);if(Object.keys(l).length>0)return void t((e=>({...e,error:l})));t((e=>({...e,isSaving:!0})));const i=await o([...e.fields.slice(0,a),s,...e.fields.slice(a+1)]);i.success?t((t=>({...t,fields:[...e.fields.slice(0,a),s,...e.fields.slice(a+1)],error:null,isSaving:!1,modals:{...t.modals,edit:{isOpen:!1,field:null,index:null,originalValues:null}}}))):t((e=>({...e,error:i.error,isSaving:!1})))}),[e.fields,e.modals.edit,o,r,t]),N=(0,l.useCallback)((e=>{t((t=>({...t,modals:{...t.modals,delete:{isOpen:!0,field:e}}})))}),[t]),O=(0,l.useCallback)((async()=>{const s=e.modals.delete.field.id;t((e=>({...e,isSaving:!0})));try{await E()({path:`/${window.documentRepositorySettings.apiNamespace}/metadata-fields/${s}/cleanup`,method:"DELETE"});const a=e.fields.filter((e=>e.id!==s)),l=await o(a);l.success?t((e=>({...e,fields:a,isSaving:!1,error:null,modals:{...e.modals,delete:{isOpen:!1,field:null}}}))):t((e=>({...e,error:l.error,isSaving:!1})))}catch(e){t((t=>({...t,error:e.message||(0,n.__)("Error deleting metadata field","bcgov-design-system"),isSaving:!1})))}}),[e.fields,e.modals.delete.field,o,t]),S=(0,l.useCallback)((()=>{t((e=>({...e,modals:{...e.modals,delete:{isOpen:!1,field:null}}})))}),[t]),x=(0,l.useCallback)((e=>{t((t=>({...t,modals:{...t.modals,[e]:{...t.modals[e],isOpen:!1,field:c(),errors:{label:"",submit:""},originalValues:null}}}))),u(!1)}),[c,t]);return e.isLoading?(0,a.createElement)("div",{className:"dswp-document-metadata-settings"},(0,a.createElement)("div",{className:"metadata-settings-loading"},(0,a.createElement)("div",{className:"spinner-wrapper"},(0,a.createElement)("div",{className:"components-spinner"})),(0,a.createElement)("p",null,(0,n.__)("Loading metadata fields…","bcgov-design-system")))):(0,a.createElement)("div",{className:"dswp-document-metadata-settings"},(0,a.createElement)("div",{className:"metadata-settings"},e.error&&(0,a.createElement)(i.Notice,{status:"error",isDismissible:!1},(0,a.createElement)("p",null,e.error)),(0,a.createElement)(i.Card,null,(0,a.createElement)(i.CardHeader,null,(0,a.createElement)("h2",null,(0,n.__)("Document Metadata Fields","bcgov-design-system")),(0,a.createElement)(i.Button,{className:"doc-repo-button save-button",onClick:()=>t((e=>({...e,modals:{...e.modals,add:{isOpen:!0,field:c(),errors:{label:"",submit:""}}}}))),disabled:e.isSaving},(0,n.__)("Add New Field","bcgov-design-system"))),(0,a.createElement)(i.CardBody,null,(0,a.createElement)("div",{className:"metadata-fields-info"},(0,a.createElement)("p",null,(0,n.__)("Customize the metadata fields that will be available for documents.","bcgov-design-system"))),(0,a.createElement)(v,{fields:e.fields,onEdit:C,onDelete:N,isSaving:e.isSaving}))),(0,a.createElement)(d,{title:(0,n.__)("Edit Metadata Field","bcgov-design-system"),isOpen:e.modals.edit.isOpen,onClose:()=>x("edit"),onSave:h,isSaving:e.isSaving,isDisabled:!m||!e.modals.edit.field?.label},(0,a.createElement)(_,{field:e.modals.edit.field,errors:e.modals.edit.errors,onChange:(e,t)=>f("edit",e,t),onOptionsChange:e=>y(e,"edit"),isEdit:!0})),(0,a.createElement)(d,{title:(0,n.__)("Add New Metadata Field","bcgov-design-system"),isOpen:e.modals.add.isOpen,onClose:()=>x("add"),onSave:w,isSaving:e.isSaving,isDisabled:!e.modals.add.field.label},(0,a.createElement)(_,{field:e.modals.add.field,errors:e.modals.add.errors,onChange:(e,t)=>f("add",e,t),onOptionsChange:e=>y(e,"add"),isEdit:!1})),(0,a.createElement)(g,{isOpen:e.modals.delete.isOpen,onClose:S,onConfirm:O,field:e.modals.delete.field,isDeleting:e.isSaving})))};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("dswp-document-repository-metadata-app");if(e)try{(0,l.render)((0,a.createElement)(w,null),e)}catch(t){e.innerHTML='<div class="notice notice-error"><p>Error initializing metadata settings. Please check the console for details.</p></div>'}}))})();