(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,s=window.wp.components,a=window.wp.i18n,n=window.ReactJSXRuntime;class o extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,n.jsxs)("div",{className:"error-boundary",children:[(0,n.jsx)("h2",{children:(0,a.__)("Something went wrong.","bcgov-design-system")}),(0,n.jsx)("p",{children:(0,a.__)("Please try refreshing the page.","bcgov-design-system")}),!1]})}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}const l=o;class i extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,n.jsx)("div",{className:"document-table-row error",role:"row",children:(0,n.jsxs)("div",{className:"document-table-cell",role:"cell",style:{textAlign:"center"},children:[(0,a.__)("Error rendering document row.","bcgov-design-system"),!1]})})}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}function d({document:e,isSelected:t,onSelect:o,onDelete:l,onEdit:i,isDeleting:d,metadataFields:r,isSpreadsheetMode:c,bulkEditedMetadata:u,onMetadataChange:m,formatFileSize:h}){const g=t=>{if(!c)return e.metadata&&e.metadata[t.id]?e.metadata[t.id]:"—";const o=u[e.id]?.[t.id]||"";if("select"===t.type){const l=Array.isArray(t.options)?t.options.map((e=>({label:e,value:e}))):Object.entries(t.options||{}).map((([e,t])=>({label:t,value:e})));return(0,n.jsx)(s.SelectControl,{value:o,options:[{label:(0,a.__)("Select…","bcgov-design-system"),value:""},...l],onChange:s=>m(e.id,t.id,s)})}return(0,n.jsx)(s.TextControl,{type:"date"===t.type?"date":"text",value:o,onChange:s=>m(e.id,t.id,s),className:"metadata-input"})};return(0,n.jsxs)("div",{className:"document-table-row",role:"row",children:[(0,n.jsx)("div",{className:"document-table-cell",role:"cell","aria-label":(0,a.__)("Select document","bcgov-design-system"),children:(0,n.jsx)(s.CheckboxControl,{checked:t,onChange:()=>o(e.id)})}),(0,n.jsx)("div",{className:"document-table-cell",role:"cell",children:e.title||e.filename}),r.map((e=>(0,n.jsx)("div",{className:"document-table-cell metadata-column",role:"cell","aria-label":(0,a.sprintf)(/* translators: %s: field label */ /* translators: %s: field label */
(0,a.__)("Edit %s","bcgov-design-system"),e.label),children:g(e)},e.id))),(0,n.jsx)("div",{className:"document-table-cell",role:"cell",children:e.metadata&&e.metadata.document_file_size?h(e.metadata.document_file_size):"—"}),(0,n.jsx)("div",{className:"document-table-cell",role:"cell",children:e.metadata&&e.metadata.document_file_type?e.metadata.document_file_type:"—"}),(0,n.jsx)("div",{className:"document-table-cell actions",role:"cell","aria-label":(0,a.__)("Document actions","bcgov-design-system"),children:!c&&(0,n.jsxs)("div",{className:"action-buttons",children:[(0,n.jsx)(s.Button,{onClick:()=>window.open(e.metadata.document_file_url,"_blank"),className:"doc-repo-button icon-button table-action-button",title:(0,a.__)("Download","bcgov-design-system"),"aria-label":(0,a.__)("Download","bcgov-design-system"),children:(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})})}),(0,n.jsx)(s.Button,{onClick:()=>i(e),className:"doc-repo-button icon-button table-action-button",title:(0,a.__)("Edit Metadata","bcgov-design-system"),"aria-label":(0,a.__)("Edit Metadata","bcgov-design-system"),children:(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"})})}),(0,n.jsx)(s.Button,{onClick:()=>l(e),className:"doc-repo-button icon-button table-action-button",title:(0,a.__)("Delete","bcgov-design-system"),"aria-label":(0,a.__)("Delete","bcgov-design-system"),disabled:d,children:(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",fill:"currentColor"})})})]})})]})}function r({documents:e,selectedDocuments:t,onSelectDocument:o,onSelectAll:l,onDelete:r,onEdit:c,isDeleting:u,metadataFields:m,isSpreadsheetMode:h,bulkEditedMetadata:g,onMetadataChange:p,formatFileSize:v}){const _=e.length>0&&t.length===e.length;return(0,n.jsxs)("div",{className:"document-table",role:"table",children:[(0,n.jsx)("div",{className:"document-table-header",role:"rowgroup",children:(0,n.jsxs)("div",{className:"document-table-row",role:"row",children:[(0,n.jsx)("div",{className:"document-table-cell header",role:"columnheader",children:(0,n.jsx)(s.CheckboxControl,{checked:_,onChange:l})}),(0,n.jsx)("div",{className:"document-table-cell header",role:"columnheader",children:(0,a.__)("Title","bcgov-design-system")}),m.map((e=>(0,n.jsx)("div",{className:"document-table-cell header metadata-column",role:"columnheader",children:e.label},e.id))),(0,n.jsx)("div",{className:"document-table-cell header",role:"columnheader",children:(0,a.__)("Size","bcgov-design-system")}),(0,n.jsx)("div",{className:"document-table-cell header",role:"columnheader",children:(0,a.__)("Type","bcgov-design-system")}),(0,n.jsx)("div",{className:"document-table-cell header",role:"columnheader",children:(0,a.__)("Actions","bcgov-design-system")})]})}),(0,n.jsx)("div",{className:"document-table-body",role:"rowgroup",children:e.map((e=>(0,n.jsx)(i,{children:(0,n.jsx)(d,{document:e,isSelected:t.includes(e.id),onSelect:o,onDelete:r,onEdit:c,isDeleting:u,metadataFields:m,isSpreadsheetMode:h,bulkEditedMetadata:g,onMetadataChange:p,formatFileSize:v})},e.id)))})]})}const c=({documents:e=[],selectedDocuments:o=[],onSelectDocument:l,onSelectAll:i,onDelete:d,onEdit:r,isDeleting:c=!1,metadataFields:u=[],isSpreadsheetMode:m=!1,bulkEditedMetadata:h={},onMetadataChange:g,formatFileSize:p})=>{const{containerRef:v,visibleRange:_,totalHeight:b,topOffset:f}=(({itemHeight:e=60,itemCount:s=0,overscan:a=5,initialHeight:n=500})=>{const o=(0,t.useRef)(null),[l,i]=(0,t.useState)({start:0,end:Math.min(20,s)}),[d,r]=(0,t.useState)(n),c=(0,t.useCallback)((()=>{if(!o.current)return;const t=o.current,n=t.scrollTop,l=t.clientHeight;let d=Math.floor(n/e);d=Math.max(0,d-a);let r=Math.ceil((n+l)/e);r=Math.min(s,r+a),i({start:d,end:r})}),[s,e,a]),u=(0,t.useCallback)((()=>{c()}),[c]);(0,t.useEffect)((()=>{const e=o.current;if(!e)return;r(e.clientHeight),c(),e.addEventListener("scroll",u);const t=()=>{e&&(r(e.clientHeight),c())};return window.addEventListener("resize",t),()=>{e.removeEventListener("scroll",u),window.removeEventListener("resize",t)}}),[c,u]),(0,t.useEffect)((()=>{c()}),[s,c]);const m=s*e,h=l.start*e;return{containerRef:o,visibleRange:l,containerHeight:d,totalHeight:m,topOffset:h,handleScroll:u,calculateVisibleRange:c}})({itemHeight:60,itemCount:e.length,overscan:5,initialHeight:500}),y=(0,t.useCallback)((e=>{i(e)}),[i]),x=e.length>0&&o.length===e.length,j=o.length>0&&o.length<e.length,S=e.slice(_.start,_.end);return(0,n.jsx)("div",{className:"virtualized-table-container",ref:v,children:(0,n.jsxs)("table",{className:"document-table",children:[(0,n.jsx)("thead",{className:"document-table__header",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"checkbox-column",children:(0,n.jsx)(s.CheckboxControl,{checked:x,indeterminate:j,onChange:y})}),(0,n.jsx)("th",{children:(0,a.__)("Document","bcgov-design-system")}),u.map((e=>(0,n.jsx)("th",{children:e.label},e.id))),(0,n.jsx)("th",{children:(0,a.__)("File Size","bcgov-design-system")}),(0,n.jsx)("th",{className:"actions-column",children:(0,a.__)("Actions","bcgov-design-system")})]})}),(0,n.jsx)("tbody",{style:{height:`${b}px`,position:"relative"},children:0===e.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:u.length+4,className:"empty-state",children:(0,a.__)("No documents found.","bcgov-design-system")})}):(0,n.jsx)("div",{className:"virtualized-rows",style:{position:"absolute",top:`${f}px`,width:"100%"},children:S.map((e=>{const t=o.includes(e.id),i=t?"document-table__row document-table__row--selected":"document-table__row";return(0,n.jsxs)("tr",{className:i,children:[(0,n.jsx)("td",{className:"checkbox-column",children:(0,n.jsx)(s.CheckboxControl,{checked:t,onChange:()=>l(e.id)})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"document-cell",children:[(0,n.jsx)("span",{className:"document-cell__title",children:e.title||e.filename||(0,a.__)("Untitled","bcgov-design-system")}),(0,n.jsx)("span",{className:"document-cell__metadata",children:e.filename||e.title||(0,a.__)("No filename","bcgov-design-system")})]})}),u.map((t=>{var s;const a=e.metadata?.[t.id]||"",o=m&&null!==(s=h[e.id]?.[t.id])&&void 0!==s?s:a;return m?(0,n.jsx)("td",{className:"editable-cell",children:(0,n.jsx)("input",{type:"text",className:"editable-field",value:o,onChange:s=>g(e.id,t.id,s.target.value)})},t.id):(0,n.jsx)("td",{children:o},t.id)})),(0,n.jsx)("td",{className:"file-size",children:e.metadata?.document_file_size?p(parseInt(e.metadata.document_file_size)):(0,a.__)("N/A","bcgov-design-system")}),(0,n.jsx)("td",{className:"actions-column",children:(0,n.jsxs)("div",{className:"action-buttons",children:[(0,n.jsx)("button",{className:"edit-button",onClick:()=>r(e),title:(0,a.__)("Edit Document","bcgov-design-system"),children:(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",children:(0,n.jsx)("path",{fill:"currentColor",d:"M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"})})}),e.metadata?.document_file_url&&(0,n.jsx)("a",{href:e.metadata.document_file_url,target:"_blank",rel:"noopener noreferrer",className:"view-button",title:(0,a.__)("View Document","bcgov-design-system"),children:(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",children:(0,n.jsx)("path",{fill:"currentColor",d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})})}),(0,n.jsx)("button",{className:"delete-button",onClick:()=>d(e),disabled:c,title:(0,a.__)("Delete Document","bcgov-design-system"),children:(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",children:(0,n.jsx)("path",{fill:"currentColor",d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})})})]})})]},e.id)}))})})]})})},u=({uploadingFiles:e,showUploadFeedback:s,onClose:o})=>{const l=e.filter((e=>"success"===e.status)).length,i=e.filter((e=>"error"===e.status)).length,d=e.filter((e=>"uploading"===e.status)).length,r=e.filter((e=>"processing"===e.status)).length,c=e.some((e=>e.isPlaceholder));return(0,t.useEffect)((()=>{if(s&&0===d&&0===r&&!c&&e.length>0){const e=setTimeout((()=>{o()}),3e3);return()=>clearTimeout(e)}}),[s,d,r,c,o,e.length]),s&&0!==e.length?(0,n.jsxs)("div",{className:"upload-feedback",children:[(0,n.jsxs)("div",{className:"upload-feedback-header",children:[(0,n.jsxs)("div",{className:"upload-feedback-title",children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})}),(0,a.__)("Document Upload Status","bcgov-design-system")]}),(0,n.jsx)("button",{className:"upload-feedback-close",onClick:()=>{0===d&&0===r&&o()},children:(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})})})]}),(0,n.jsx)("div",{className:"upload-feedback-items",children:e.map((e=>(0,n.jsxs)("div",{className:`upload-feedback-item ${e.status} ${e.isPlaceholder?"placeholder":""}`,children:[(0,n.jsx)("span",{className:"upload-feedback-item-name",children:e.name}),"processing"===e.status&&(0,n.jsx)(n.Fragment,{children:(0,a.__)("Processing…","bcgov-design-system")}),"uploading"===e.status&&(0,n.jsx)(n.Fragment,{children:(0,a.__)("Uploading…","bcgov-design-system")}),"success"===e.status&&(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})}),"error"===e.status&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})}),e.error&&(0,n.jsx)("span",{className:"upload-feedback-item-error",children:e.error})]})]},e.id)))}),(0,n.jsx)("div",{className:"upload-feedback-summary",children:c?(0,n.jsxs)("div",{className:"processing",children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})}),(0,a.__)("Preparing files…","bcgov-design-system")]}):(0,n.jsxs)(n.Fragment,{children:[r>0&&(0,n.jsxs)("div",{className:"processing",children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})}),(0,a.sprintf)(/* translators: %d: number of files being processed */ /* translators: %d: number of files being processed */
(0,a.__)("Processing %d files…","bcgov-design-system"),r)]}),d>0&&(0,n.jsxs)("div",{className:"uploading",children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})}),(0,a.sprintf)(/* translators: %d: number of files being uploaded */ /* translators: %d: number of files being uploaded */
(0,a.__)("Uploading %d files…","bcgov-design-system"),d)]}),l>0&&(0,n.jsxs)("div",{className:"success",children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})}),(0,a.sprintf)(/* translators: %d: number of files that were successfully uploaded */ /* translators: %d: number of files that were successfully uploaded */
(0,a.__)("%d files uploaded successfully","bcgov-design-system"),l)]}),i>0&&(0,n.jsxs)("div",{className:"error",children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",children:(0,n.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})}),(0,a.sprintf)(/* translators: %d: number of files that failed to upload */ /* translators: %d: number of files that failed to upload */
(0,a.__)("%d files failed to upload","bcgov-design-system"),i)]})]})})]}):null},m=({title:e,isOpen:o,onClose:l,onSave:i,isSaving:d=!1,isDisabled:r=!1,saveButtonText:c,saveButtonClassName:u="doc-repo-button save-button",children:m})=>{const h=(0,t.useCallback)((e=>{e&&(e.preventDefault(),e.stopPropagation()),l()}),[l]),g=(0,t.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),i()}),[i]);return o?(0,n.jsx)(s.Modal,{title:e,onRequestClose:h,className:"metadata-edit-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0,children:(0,n.jsxs)("form",{onSubmit:g,className:"metadata-edit-form",children:[m,(0,n.jsxs)("div",{className:"modal-actions",children:[(0,n.jsx)(s.Button,{onClick:h,disabled:d,className:"doc-repo-button cancel-button",children:(0,a.__)("Cancel","bcgov-design-system")}),(0,n.jsx)(s.Button,{type:"submit",isBusy:d,disabled:d||r,className:u,children:c||(0,a.__)("Save Changes","bcgov-design-system")})]})]})}):null},h=({onFilesSelected:e,acceptMimeTypes:o="application/pdf"})=>{const[l,i]=(0,t.useState)(!1),d=(0,t.useRef)(null),r=(0,t.useRef)(null);(0,t.useEffect)((()=>()=>{r.current&&clearTimeout(r.current)}),[]);const c=(0,t.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),i(!0)}),[]),u=(0,t.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),l||i(!0)}),[l]),m=(0,t.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),!e.currentTarget.contains(e.relatedTarget)&&(r.current=setTimeout((()=>{i(!1)}),50))}),[]),h=(0,t.useCallback)((t=>{t.preventDefault(),t.stopPropagation(),i(!1);const s=t.dataTransfer.files;s&&s.length>0&&e(Array.from(s))}),[e]),g=(0,t.useCallback)((t=>{const s=Array.from(t.target.files);s.length>0&&e(s)}),[e]),p=(0,t.useCallback)((e=>{e&&e.stopPropagation(),d.current&&d.current.click()}),[d]),v=(0,t.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),p())}),[p]);return(0,n.jsxs)("div",{className:"upload-area__container "+(l?"upload-area__container--drag-active":""),onDragEnter:c,onDragOver:u,onDragLeave:m,onDrop:h,onClick:p,onKeyDown:v,tabIndex:"0",role:"button","aria-label":(0,a.__)("Click or drag files to upload","bcgov-design-system"),children:[(0,n.jsx)("input",{type:"file",ref:d,className:"upload-area__file-input",onChange:g,multiple:!0,accept:o,"aria-hidden":"true"}),(0,n.jsxs)("div",{className:"upload-area__content",children:[(0,n.jsx)("div",{className:"upload-area__icon",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"48",height:"48",children:(0,n.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z",fill:"currentColor"})})}),(0,n.jsx)("h3",{className:"upload-area__text",children:(0,a.__)("Drag & Drop or Click to Upload","bcgov-design-system")}),(0,n.jsx)("p",{className:"upload-area__help-text",children:(0,a.__)("Upload PDF documents to the repository","bcgov-design-system")}),(0,n.jsx)(s.Button,{className:"upload-area__button",onClick:e=>{e.stopPropagation(),p()},children:(0,a.__)("Choose Files","bcgov-design-system")})]})]})},g=({currentPage:e,totalPages:t,onPageChange:o})=>t<=1?null:(0,n.jsxs)("div",{className:"pagination",children:[(0,n.jsx)(s.Button,{onClick:()=>o(e-1),disabled:1===e,children:(0,a.__)("Previous","bcgov-design-system")}),(0,n.jsx)("span",{className:"page-info",children:(0,a.sprintf)(/* translators: %1$d: current page number, %2$d: total number of pages */ /* translators: %1$d: current page number, %2$d: total number of pages */
(0,a.__)("Page %1$d of %2$d","bcgov-design-system"),e,t)}),(0,n.jsx)(s.Button,{onClick:()=>o(e+1),disabled:e===t,children:(0,a.__)("Next","bcgov-design-system")})]}),p=({failedOperations:e,onRetryAll:t})=>0===e.length?null:(0,n.jsxs)(s.Notice,{status:"warning",isDismissible:!1,className:"retry-notice",children:[(0,n.jsx)("p",{children:(0,a.sprintf)(/* translators: %d: number of failed operations */ /* translators: %d: number of failed operations */
(0,a.__)("There are %d failed operations that can be retried.","bcgov-design-system"),e.length)}),(0,n.jsx)(s.Button,{variant:"secondary",onClick:t,children:(0,a.__)("Retry All","bcgov-design-system")})]}),v=window.wp.apiFetch;var _=e.n(v);const b=(e,t)=>{switch(t.type){case"SET_EDITING_DOCUMENT":return{...e,editingMetadata:t.payload,editedValues:t.initialValues||{},errors:{}};case"CLEAR_EDITING_DOCUMENT":return{...e,editingMetadata:null,editedValues:{},errors:{}};case"UPDATE_EDITED_VALUES":return{...e,editedValues:{...e.editedValues,...t.payload}};case"SET_ERRORS":return{...e,errors:t.payload};case"SET_IS_SAVING":return{...e,isSaving:t.payload};case"ENTER_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!0,bulkEditedMetadata:t.initialBulkValues||{},hasMetadataChanges:!1};case"EXIT_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1};case"UPDATE_BULK_METADATA":return{...e,bulkEditedMetadata:{...e.bulkEditedMetadata,[t.documentId]:{...e.bulkEditedMetadata[t.documentId],[t.fieldId]:t.value}},hasMetadataChanges:t.hasChanges};case"SET_IS_SAVING_BULK":return{...e,isSavingBulk:t.payload};case"CLEAR_BULK_CHANGES":return{...e,bulkEditedMetadata:{},hasMetadataChanges:!1};default:return e}},f=({documents:e=[],currentPage:o=1,totalPages:i=1,onPageChange:d,onDelete:v,isDeleting:f=!1,selectedDocuments:y=[],onSelectDocument:x,onSelectAll:j,onFileDrop:S,onDocumentsUpdate:w,metadataFields:N=[]})=>{const C=(0,t.useMemo)((()=>e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}),[]),D=(0,t.useMemo)((()=>{const e=window.documentRepositorySettings;return e?.apiNamespace||"wp/v2"}),[]),{showNotification:E}=(()=>{const[e,s]=(0,t.useState)(null);return{notice:e,showNotification:(0,t.useCallback)(((e,t,a=3e3)=>{s({status:e,message:t}),a>0&&setTimeout((()=>s(null)),a)}),[]),clearNotification:(0,t.useCallback)((()=>{s(null)}),[])}})(),{failedOperations:k,handleOperationError:M,retryAllOperations:F}=(({onShowNotification:e})=>{const[s,n]=(0,t.useState)([]),[o,l]=(0,t.useState)({}),i=(0,t.useCallback)(((t,s,o,i={})=>{const{addToRetryQueue:d=!0,showNotice:r=!0,customMessage:c=null}=i;if(d&&(n((e=>[...e,{type:t,documentId:s,error:o}])),l((e=>({...e,[s]:(e[s]||0)+1})))),r&&e){const t=c||o.message||o.data?.message||(0,a.__)("An unknown error occurred.","bcgov-design-system");e("error",s?(0,a.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,a.__)("Operation failed for document %1$d: %2$s","bcgov-design-system"),s,t):t)}}),[e]),d=(0,t.useCallback)((async(t,s)=>{if(o[t.documentId]>=3)e("error",(0,a.sprintf)(/* translators: %1$d: document ID */ /* translators: %1$d: document ID */
(0,a.__)("Maximum retry attempts reached for document %1$d","bcgov-design-system"),t.documentId));else try{const e=s[t.type];if(!e)return{error:`Unknown operation type: ${t.type}`};await e(t.documentId),n((e=>e.filter((e=>!(e.type===t.type&&e.documentId===t.documentId)))))}catch(e){i(t.type,t.documentId,e)}}),[o,i,e]),r=(0,t.useCallback)((e=>{s.forEach((t=>d(t,e)))}),[s,d]);return{failedOperations:s,handleOperationError:i,retryOperation:d,retryAllOperations:r}})({onShowNotification:E}),{deleteDocument:T,bulkDeleteConfirmOpen:P,isMultiDeleting:B,setDeleteDocument:R,handleBulkDelete:O,handleSingleDelete:A,openBulkDeleteConfirm:I,closeBulkDeleteConfirm:z}=(({onDelete:e,onSelectAll:s,onShowNotification:n,onError:o})=>{const[l,i]=(0,t.useState)(null),[d,r]=(0,t.useState)(!1),[c,u]=(0,t.useState)(!1),m=(0,t.useCallback)((async t=>{if(t&&0!==t.length){u(!0);try{await Promise.all(t.map((t=>e(t)))),r(!1),s(!1),n&&n("success",(0,a.__)("Selected documents were deleted successfully.","bcgov-design-system"))}catch(e){o&&o("bulk-delete",null,e,{addToRetryQueue:!1,customMessage:(0,a.__)("Error deleting one or more documents.","bcgov-design-system")})}finally{u(!1)}}}),[e,s,n,o]),h=(0,t.useCallback)((async t=>{try{await e(t),i(null),n&&n("success",(0,a.__)("Document deleted successfully.","bcgov-design-system"))}catch(e){o&&o("delete",t,e,{customMessage:(0,a.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,a.__)("Error deleting document %1$d: %2$s","bcgov-design-system"),t,e.message||(0,a.__)("An unknown error occurred","bcgov-design-system"))})}}),[e,n,o]),g=(0,t.useCallback)((()=>{r(!0)}),[]),p=(0,t.useCallback)((()=>{r(!1)}),[]);return{deleteDocument:l,bulkDeleteConfirmOpen:d,isMultiDeleting:c,setDeleteDocument:i,handleBulkDelete:m,handleSingleDelete:h,openBulkDeleteConfirm:g,closeBulkDeleteConfirm:p}})({onDelete:v,onSelectAll:j,onShowNotification:E,onError:M}),{editingMetadata:U,editedValues:L,errors:$,isSaving:V,hasMetadataChanged:H,handleEditMetadata:q,updateEditedField:G,handleSaveMetadata:K,isSpreadsheetMode:W,hasMetadataChanges:X,bulkEditedMetadata:J,isSavingBulk:Q,handleMetadataChange:Y,toggleSpreadsheetMode:Z,handleSaveBulkChanges:ee,localDocuments:te}=(({documents:e=[],metadataFields:s=[],apiNamespace:n,onUpdateDocuments:o,onError:l,onShowNotification:i})=>{const[d,r]=(0,t.useReducer)(b,{editingMetadata:null,editedValues:{},errors:{},isSaving:!1,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1,isSavingBulk:!1}),[c,u]=(0,t.useState)(e);(0,t.useEffect)((()=>{u(e)}),[e]);const m=(0,t.useCallback)((()=>{const{editingMetadata:e,editedValues:t}=d;return!!e&&s.some((s=>(e.metadata?.[s.id]||"")!==(t[s.id]||"")))}),[d,s]),h=(0,t.useCallback)((e=>{if(!e)return void r({type:"CLEAR_EDITING_DOCUMENT"});const t={...e,upload_date:e.date||e.upload_date||e.metadata?.upload_date},a={};s.forEach((t=>{var s;a[t.id]=null!==(s=e.metadata?.[t.id])&&void 0!==s?s:""})),r({type:"SET_EDITING_DOCUMENT",payload:t,initialValues:a})}),[s]),g=(0,t.useCallback)(((e,t,s)=>{const a={...d.bulkEditedMetadata,[e]:{...d.bulkEditedMetadata[e],[t]:s}},n=Object.entries(a).some((([e,t])=>{const s=c.find((t=>t.id===parseInt(e)));return!!s&&Object.entries(t).some((([e,t])=>{const a=s.metadata?.[e]||"";return String(a)!==String(t)}))}));r({type:"UPDATE_BULK_METADATA",documentId:e,fieldId:t,value:s,hasChanges:n}),u((a=>a.map((a=>a.id===e?{...a,metadata:{...a.metadata,[t]:s}}:a))))}),[c,d.bulkEditedMetadata,r]),p=(0,t.useCallback)(((e,t)=>{r({type:"UPDATE_EDITED_VALUES",payload:{[e]:t}})}),[r]),v=(0,t.useCallback)((async()=>{const{editingMetadata:e,editedValues:t}=d;if(e){r({type:"SET_IS_SAVING",payload:!0});try{await _()({path:`/${n}/documents/${e.id}/metadata`,method:"POST",data:t}),u((s=>s.map((s=>s.id===e.id?{...s,metadata:{...s.metadata,...t}}:s)))),"function"==typeof o&&o(c.map((s=>s.id===e.id?{...s,metadata:{...s.metadata,...t}}:s))),r({type:"CLEAR_EDITING_DOCUMENT"}),i&&i("success",(0,a.__)("Document metadata updated successfully","bcgov-design-system"))}catch(t){t.data?.errors&&r({type:"SET_ERRORS",payload:t.data.errors}),l&&l("metadata",e.id,t,{customMessage:t.data?.message||(0,a.__)("Failed to update metadata","bcgov-design-system")})}finally{r({type:"SET_IS_SAVING",payload:!1})}}}),[d,n,c,o,i,l,r]),f=(0,t.useCallback)((e=>{if(e){const e={};c.forEach((t=>{e[t.id]={...t.metadata||{}}})),r({type:"ENTER_SPREADSHEET_MODE",initialBulkValues:e})}else r({type:"EXIT_SPREADSHEET_MODE"})}),[c]),y=(0,t.useCallback)((async()=>{const{bulkEditedMetadata:e}=d;r({type:"SET_IS_SAVING_BULK",payload:!0});try{const t=(await Promise.allSettled(Object.entries(e).map((([e,t])=>_()({path:`/${n}/documents/${e}/metadata`,method:"POST",data:t}))))).map(((t,s)=>({result:t,docId:Object.keys(e)[s]}))).filter((({result:e})=>"rejected"===e.status));t.length>0?(t.forEach((({result:e,docId:t})=>{l&&l("metadata",t,e.reason,{showNotice:!1})})),i&&i("warning",(0,a.sprintf)(/* translators: %1$d: number of failed updates, %2$d: total number of updates */ /* translators: %1$d: number of failed updates, %2$d: total number of updates */
(0,a.__)("%1$d of %2$d metadata updates failed. You can retry the failed operations.","bcgov-design-system"),t.length,Object.keys(e).length),0)):(i&&i("success",(0,a.__)("All metadata changes saved successfully.","bcgov-design-system")),r({type:"CLEAR_BULK_CHANGES"}),r({type:"EXIT_SPREADSHEET_MODE"}))}catch(e){l&&l("bulk-metadata",null,e)}finally{r({type:"SET_IS_SAVING_BULK",payload:!1})}}),[d,n,l,i]);return{editingMetadata:d.editingMetadata,editedValues:d.editedValues,errors:d.errors,isSaving:d.isSaving,hasMetadataChanged:m,handleEditMetadata:h,updateEditedField:p,handleSaveMetadata:v,isSpreadsheetMode:d.isSpreadsheetMode,hasMetadataChanges:d.hasMetadataChanges,bulkEditedMetadata:d.bulkEditedMetadata,isSavingBulk:d.isSavingBulk,handleMetadataChange:g,toggleSpreadsheetMode:f,handleSaveBulkChanges:y,localDocuments:c}})({documents:e,metadataFields:N,apiNamespace:D,onUpdateDocuments:w,onError:M,onShowNotification:E}),{uploadingFiles:se,showUploadFeedback:ae,handleFiles:ne,closeUploadFeedback:oe}=(({onFileDrop:e,onShowNotification:s,onError:n})=>{const[o,l]=(0,t.useState)([]),[i,d]=(0,t.useState)(!1);return{uploadingFiles:o,showUploadFeedback:i,handleFiles:(0,t.useCallback)((t=>{if(d(!0),!t||0===t.length)return s&&s("error",(0,a.__)("No files were selected for upload.","bcgov-design-system")),void d(!1);l([{id:"placeholder",name:(0,a.sprintf)(/* translators: %d: number of files being prepared */ /* translators: %d: number of files being prepared */
(0,a.__)("Preparing %d files…","bcgov-design-system"),t.length),status:"processing",error:null,isPlaceholder:!0}]);const o=t.map((e=>({id:Math.random().toString(36).substr(2,9),name:e.name,originalFile:e,status:"processing",error:null})));l(o);const i=[],r=[];t.forEach((e=>{"application/pdf"===e.type||e.name.toLowerCase().endsWith(".pdf")?i.push(e):r.push(e)})),l((e=>e.map((e=>{const s=t.find((t=>t.name===e.name)),n=s&&("application/pdf"===s.type||s.name.toLowerCase().endsWith(".pdf"));return{...e,status:n?"uploading":"error",error:n?null:(0,a.__)("Not a PDF file. Only PDF files are allowed.","bcgov-design-system")}})))),r.length>0&&s&&s("warning",(0,a.sprintf)(/* translators: %1$d: number of skipped files, %2$d: total number of files */ /* translators: %1$d: number of skipped files, %2$d: total number of files */
(0,a.__)("%1$d of %2$d files were skipped because they are not PDFs.","bcgov-design-system"),r.length,t.length)),0!==i.length&&i.forEach((t=>{e(t).then((()=>{l((e=>e.map((e=>e.name===t.name?{...e,status:"success"}:e))))})).catch((e=>{l((s=>s.map((s=>s.name===t.name?{...s,status:"error",error:e.message||(0,a.__)("Upload failed. Please try again.","bcgov-design-system")}:s)))),n&&n("upload",t.name,e,{addToRetryQueue:!1,customMessage:(0,a.sprintf)(/* translators: %1$s: file name, %2$s: error message */ /* translators: %1$s: file name, %2$s: error message */
(0,a.__)('Error uploading "%1$s": %2$s',"bcgov-design-system"),t.name,e.message||(0,a.__)("Upload failed","bcgov-design-system"))})}))}))}),[e,s,n]),closeUploadFeedback:(0,t.useCallback)((()=>{d(!1),l([])}),[])}})({onFileDrop:S,onShowNotification:E,onError:M}),le=(0,t.useCallback)((()=>{F({delete:v,metadata:K})}),[v,K,F]),ie=(0,t.useMemo)((()=>({documents:te,selectedDocuments:y,onSelectDocument:x,onSelectAll:j,onDelete:R,onEdit:q,isDeleting:f,metadataFields:N,isSpreadsheetMode:W,bulkEditedMetadata:J,onMetadataChange:Y,formatFileSize:C})),[te,y,x,j,f,N,W,J,q,Y,C,R]);return(0,n.jsx)(l,{children:(0,n.jsxs)("div",{className:"document-list",children:[(0,n.jsx)(p,{failedOperations:k,onRetryAll:le}),(0,n.jsxs)("div",{className:"document-list__actions",children:[(0,n.jsx)("div",{className:"document-list__left-actions"}),(0,n.jsx)("div",{className:"document-list__right-actions",children:(0,n.jsx)(h,{onFilesSelected:e=>{ne(e)}})})]}),(0,n.jsx)("div",{className:"document-list__table-actions",children:(0,n.jsxs)("div",{className:"action-buttons-container",children:[(0,n.jsx)(s.Button,{className:"doc-repo-button spreadsheet-toggle"+(W?" isPressed":""),onClick:()=>Z(!W),isPressed:W,children:W?(0,a.__)("Exit Spreadsheet Mode","bcgov-design-system"):(0,a.__)("Enter Spreadsheet Mode","bcgov-design-system")}),W&&X&&(0,n.jsx)(s.Button,{className:"doc-repo-button save-button",onClick:ee,isBusy:Q,disabled:Q,children:Q?(0,a.__)("Saving…","bcgov-design-system"):(0,a.__)("Save Changes","bcgov-design-system")}),y.length>0&&(0,n.jsx)(s.Button,{className:"doc-repo-button delete-button bulk-delete-button",onClick:I,disabled:B,children:(0,a.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,a.__)("Delete Selected (%d)","bcgov-design-system"),y.length)})]})}),e.length>=50?(0,n.jsx)(c,{...ie}):(0,n.jsx)(r,{...ie}),(0,n.jsx)(g,{currentPage:o,totalPages:i,onPageChange:d}),ae&&(0,n.jsx)(u,{uploadingFiles:se,showUploadFeedback:ae,onClose:oe}),T&&(0,n.jsx)(m,{title:(0,a.__)("Delete Document","bcgov-design-system"),isOpen:!!T,onClose:()=>R(null),onSave:()=>A(T.id),isSaving:f,isDisabled:!1,saveButtonText:f?(0,a.__)("Deleting…","bcgov-design-system"):(0,a.__)("Delete","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button",children:(0,n.jsxs)("div",{className:"delete-confirmation-content",children:[(0,n.jsx)("div",{className:"delete-warning",children:(0,a.__)("Are you sure you want to delete this document? This action cannot be undone.","bcgov-design-system")}),(0,n.jsxs)("div",{className:"documents-to-delete",children:[(0,n.jsx)("h4",{children:(0,a.__)("Document to be deleted:","bcgov-design-system")}),(0,n.jsx)("ul",{children:(0,n.jsx)("li",{children:T.title})})]})]})}),P&&(0,n.jsx)(m,{title:(0,a.__)("Delete Selected Documents","bcgov-design-system"),isOpen:P,onClose:z,onSave:()=>O(y),isSaving:B,isDisabled:!1,saveButtonText:B?(0,a.__)("Deleting…","bcgov-design-system"):(0,a.__)("Delete Selected","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button",children:(0,n.jsxs)("div",{className:"delete-confirmation-content",children:[(0,n.jsx)("div",{className:"delete-warning",children:(0,a.__)("Are you sure you want to delete the selected documents? This action cannot be undone.","bcgov-design-system")}),(0,n.jsxs)("div",{className:"documents-to-delete",children:[(0,n.jsx)("h4",{children:(0,a.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,a.__)("Documents to be deleted (%d):","bcgov-design-system"),y.length)}),(0,n.jsx)("ul",{children:te.filter((e=>y.includes(e.id))).map((e=>(0,n.jsx)("li",{children:e.title},e.id)))})]})]})}),U&&(0,n.jsxs)(m,{title:(0,a.__)("Edit Document Metadata","bcgov-design-system"),isOpen:!!U,onClose:()=>q(null),onSave:K,isSaving:V,isDisabled:!H,saveButtonText:V?(0,a.__)("Saving…","bcgov-design-system"):(0,a.__)("Save Changes","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button",children:[(0,n.jsx)("div",{className:"editable-metadata",children:N.map((e=>(0,n.jsxs)("div",{className:"metadata-field",children:[(0,n.jsx)("label",{htmlFor:e.id,children:e.label}),"select"===e.type?(0,n.jsx)(s.SelectControl,{id:e.id,value:L[e.id]||"",options:[{label:(0,a.__)("Select…","bcgov-design-system"),value:""},...e.options.map((e=>({label:e,value:e})))],onChange:t=>G(e.id,t)}):(0,n.jsx)(s.TextControl,{id:e.id,value:L[e.id]||"",onChange:t=>G(e.id,t)}),$[e.id]&&(0,n.jsx)("div",{className:"metadata-error",children:$[e.id]})]},e.id)))}),(0,n.jsxs)("div",{className:"non-editable-metadata",children:[(0,n.jsx)("h3",{children:(0,a.__)("Document Information","bcgov-design-system")}),(0,n.jsxs)("div",{className:"metadata-field",children:[(0,n.jsx)("label",{htmlFor:"document-filename",children:(0,a.__)("Filename","bcgov-design-system")}),(0,n.jsx)("div",{id:"document-filename",className:"field-value",children:(U.metadata?.document_file_name||U.filename||U.title||"").replace(/\.pdf$/i,"")||(0,a.__)("Not available","bcgov-design-system")})]}),(0,n.jsxs)("div",{className:"metadata-field",children:[(0,n.jsx)("label",{htmlFor:"document-file-type",children:(0,a.__)("File Type","bcgov-design-system")}),(0,n.jsx)("div",{id:"document-file-type",className:"field-value",children:U.metadata?.document_file_type||"PDF"})]}),(0,n.jsxs)("div",{className:"metadata-field",children:[(0,n.jsx)("label",{htmlFor:"document-file-size",children:(0,a.__)("File Size","bcgov-design-system")}),(0,n.jsx)("div",{id:"document-file-size",className:"field-value",children:U.metadata?.document_file_size?C(parseInt(U.metadata.document_file_size)):(0,a.__)("Not available","bcgov-design-system")})]})]})]})]})})},y=({metadataFields:e,onUploadSuccess:o,selectedFile:l=null,modalMode:i=!1})=>{const[d,r]=(0,t.useState)(l),[c,u]=(0,t.useState)(!1),[m,h]=(0,t.useState)(0),[g,p]=(0,t.useState)(null),[v,_]=(0,t.useState)(!1),[b,f]=(0,t.useState)(!1),y=(0,t.useRef)(null),x=(0,t.useRef)(null),[j,S]=(0,t.useState)(l?l.name.split(".")[0]:""),[w,N]=(0,t.useState)({}),{apiNamespace:C,maxFileSize:D,allowedMimeTypes:E}=window.documentRepositorySettings,k=(0,t.useCallback)((e=>{if(!e)return!1;if(e.size>D){const t=`File "${e.name}" is too large (${(e.size/1048576).toFixed(2)} MB). Maximum allowed size is ${(D/1048576).toFixed(2)} MB.`;return p(t),!1}const t=e.name.split(".").pop().toLowerCase(),s=Object.keys(E);if(!s.includes(t)){const t=`File "${e.name}" has an invalid file type. Allowed types are: ${s.join(", ")}`;return p(t),!1}return p(null),!0}),[D,E]),M=(0,t.useCallback)((e=>{if(!e)return!1;if(k(e)){r(e);const t=e.name.includes(".")?e.name.substring(0,e.name.lastIndexOf(".")):e.name;return S(t),!0}return!1}),[k]);(0,t.useEffect)((()=>{if(l&&(S(l.name.replace(/\.[^/.]+$/,"")),!k(l)))return{error:"Initial file validation failed, but still setting file for UI"}}),[l,k]),(0,t.useEffect)((()=>{i&&!d&&l&&r(l)}),[i,l,d]);const F=e=>{const t=e.target.files[0];M(t)},T=()=>{y.current&&y.current.click()},P=(e,t)=>{N((s=>({...s,[e]:t})))},B=async()=>{if(!d)return void p("Please select a file to upload.");if(!k(d))return;u(!0),p(null),h(0);const e=new FormData;e.append("file",d),e.append("title",j);const t=JSON.stringify(w);e.append("metadata",t);try{const t=await fetch(`${window.documentRepositorySettings.apiRoot}${C}/documents`,{method:"POST",headers:{"X-WP-Nonce":window.documentRepositorySettings.nonce},body:e});if(!t.ok){const e=await t.json();throw new Error(e.message||"Upload failed")}const s=await t.json();_(!0),u(!1),o&&o(s.document),i||(r(null),S(""),N({}))}catch(e){p(e.message||"Failed to upload file. Please try again."),u(!1)}},R=e=>{const{id:t,label:o,type:l,options:i,required:d}=e;switch(l){case"text":return(0,n.jsx)(s.TextControl,{label:o,value:w[t]||"",onChange:e=>P(t,e),required:d},t);case"select":return(0,n.jsx)(s.SelectControl,{label:o,value:w[t]||"",options:[{label:(0,a.__)("Select…","bcgov-design-system"),value:""},...Object.entries(i).map((([e,t])=>({label:t,value:e})))],onChange:e=>P(t,e),required:d},t);case"date":return(0,n.jsx)(s.TextControl,{label:o,type:"date",value:w[t]||"",onChange:e=>P(t,e),required:d},t);default:return null}},O=()=>c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.Spinner,{}),(0,a.__)("Uploading…","bcgov-design-system")]}):(0,a.__)("Upload Document","bcgov-design-system");return i?(0,n.jsxs)("div",{className:"document-uploader-modal",children:[g&&(0,n.jsx)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>p(null),children:g}),v&&(0,n.jsx)(s.Notice,{status:"success",isDismissible:!0,onRemove:()=>_(!1),children:(0,a.__)("Document uploaded successfully!","bcgov-design-system")}),(0,n.jsx)("div",{className:"selected-file-info",children:d?(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"File:"})," ",d.name," (",Math.round(d.size/1024)," KB)"]}):l?(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"File:"})," ",l.name," (",Math.round(l.size/1024)," KB)"]}):(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Warning:"})," No file selected"]})}),(0,n.jsx)(s.TextControl,{label:(0,a.__)("Document Title","bcgov-design-system"),value:j,onChange:S,disabled:c,required:!0}),(0,n.jsx)("h4",{children:(0,a.__)("Document Metadata","bcgov-design-system")}),(0,n.jsx)("div",{className:"metadata-fields modal-layout",children:e.map(R)}),c&&(0,n.jsxs)("div",{className:"upload-progress",children:[(0,n.jsx)("progress",{value:m,max:"100"}),(0,n.jsxs)("p",{children:[m,"%"," ",(0,a.__)("Uploaded","bcgov-design-system")]})]}),(0,n.jsx)("div",{className:"modal-actions",children:(0,n.jsx)(s.Button,{isPrimary:!0,onClick:B,disabled:!d&&!l||!j||c,children:O()})})]}):(0,n.jsxs)(s.Card,{className:"document-uploader",children:[(0,n.jsx)(s.CardHeader,{children:(0,n.jsx)("h3",{children:(0,a.__)("Upload Document","bcgov-design-system")})}),(0,n.jsx)(s.CardBody,{children:(0,n.jsxs)(n.Fragment,{children:[v&&(0,n.jsx)(s.Notice,{status:"success",isDismissible:!0,onRemove:()=>_(!1),children:(0,a.__)("Document uploaded successfully!","bcgov-design-system")}),g&&(0,n.jsx)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>p(null),children:g}),!i&&!d&&(0,n.jsxs)("div",{className:"upload-area__container "+(b?"upload-area__container--drag-active":""),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),f(!0)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),f(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation();const t=x.current.getBoundingClientRect();(e.clientX<t.left||e.clientX>=t.right||e.clientY<t.top||e.clientY>=t.bottom)&&f(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),f(!1);const t=Array.from(e.dataTransfer.files);var s;t.length>0&&(s=t[0],M(s))},onClick:T,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||T()},role:"button",tabIndex:"0",ref:x,children:[(0,n.jsx)("input",{type:"file",ref:y,onChange:F,className:"upload-area__file-input",accept:Object.values(E).join(",")}),(0,n.jsxs)("div",{className:"upload-area__content",children:[(0,n.jsx)("div",{className:"upload-area__icon",children:(0,n.jsxs)("svg",{viewBox:"0 0 64 64",width:"64",height:"64",children:[(0,n.jsx)("path",{d:"M32 16v24M20 28l12-12 12 12",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{d:"M16 48h32M12 20v28c0 2.2 1.8 4 4 4h32c2.2 0 4-1.8 4-4V20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,n.jsxs)("div",{className:"upload-area__text",children:[(0,n.jsx)("p",{className:"upload-area__text-primary",children:b?(0,a.__)("Drop file here","bcgov-design-system"):(0,a.__)("Drag & drop your file here or click to browse","bcgov-design-system")}),(0,n.jsxs)("p",{className:"upload-area__help-text",children:[(0,a.__)("Accepted file types:","bcgov-design-system")," ",Object.keys(E).join(", ")]}),(0,n.jsxs)("p",{className:"upload-area__help-text",children:[(0,a.__)("Maximum file size:","bcgov-design-system")," ",Math.round(D/1048576)," ","MB"]})]})]})]}),i&&!d&&(0,n.jsx)("div",{className:"document-uploader-file-select",children:(0,n.jsx)(s.FormFileUpload,{accept:Object.values(E).join(","),onChange:F,children:(0,a.__)("Select a different file","bcgov-design-system")})}),d&&(0,n.jsxs)("div",{className:"selected-file-container",children:[(0,n.jsxs)("div",{className:"selected-file",children:[(0,n.jsx)("span",{className:"file-name",children:d.name}),(0,n.jsx)("button",{type:"button",className:"remove-file",onClick:()=>r(null),children:"✕"})]}),!i&&(0,n.jsx)(s.FormFileUpload,{accept:Object.values(E).join(","),onChange:F,children:(0,a.__)("Select a different file","bcgov-design-system")})]}),c&&(0,n.jsxs)("div",{className:"upload-progress",children:[(0,n.jsx)("progress",{value:m,max:"100"}),(0,n.jsxs)("p",{children:[m,"%"," ",(0,a.__)("Uploaded","bcgov-design-system")]})]}),(0,n.jsx)(s.TextControl,{label:(0,a.__)("Document Title","bcgov-design-system"),value:j,onChange:S,disabled:c,required:!0}),(0,n.jsx)("h4",{children:(0,a.__)("Document Metadata","bcgov-design-system")}),(0,n.jsx)("div",{className:"metadata-fields "+(i?"modal-layout":""),children:e.map(R)})]})}),(0,n.jsx)(s.CardFooter,{children:(0,n.jsx)("div",{className:"card-actions",children:(0,n.jsx)(s.Button,{isPrimary:!0,onClick:B,disabled:!d||!j||c,children:O()})})})]})};class x extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}render(){return this.state.hasError?(0,n.jsx)("div",{className:"dswp-document-repository-error",children:(0,n.jsxs)(s.Notice,{status:"error",isDismissible:!1,children:[(0,n.jsx)("h2",{children:(0,a.__)("Something went wrong in the Document Repository","bcgov-design-system")}),(0,n.jsx)("p",{children:this.state.error&&this.state.error.toString()}),(0,n.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:this.state.errorInfo&&this.state.errorInfo.componentStack})]})}):this.props.children}}const j=x,S=()=>{const[e,o]=(0,t.useState)(!0),[l,i]=(0,t.useState)(null),[d,r]=(0,t.useState)("Initializing"),[c,u]=(0,t.useState)([]),[m,h]=(0,t.useState)(!1),[g,p]=(0,t.useState)(!1),[v,b]=(0,t.useState)(null),{documents:x,totalDocuments:S,currentPage:w,totalPages:N,fetchDocuments:C,deleteDocument:D,isDeleting:E,isLoading:k,error:M,setSearchParams:F}=(()=>{const[e,s]=(0,t.useState)([]),[a,n]=(0,t.useState)(0),[o,l]=(0,t.useState)(1),[i,d]=(0,t.useState)(1),[r,c]=(0,t.useState)(!1),[u,m]=(0,t.useState)(!1),[h,g]=(0,t.useState)(null),[p,v]=(0,t.useState)({page:1,per_page:window.documentRepositorySettings?.perPage||20,orderby:"date",order:"DESC"}),b=(0,t.useCallback)((async()=>{if(window.documentRepositorySettings?.apiNamespace){c(!0),g(null);try{const{apiNamespace:e}=window.documentRepositorySettings,t=new URLSearchParams;Object.entries(p).forEach((([e,s])=>{s&&t.append(e,s)}));const a=new Promise(((e,t)=>{setTimeout((()=>{t(new Error("Document fetch request timed out. Please try again."))}),5e3)})),o=await Promise.race([_()({path:`/${e}/documents?${t.toString()}`}),a]);if(!o||"object"!=typeof o)throw new Error("Invalid response from server");const i=Array.isArray(o.documents)?o.documents.filter((e=>e&&"object"==typeof e&&e.id)):[];s(i),n(o.total||0),l(o.current_page||1),d(o.total_pages||1),0===i.length&&p.page>1&&v((e=>({...e,page:1})))}catch(e){g(e.message||"Error loading documents"),1===p.page&&(s([]),n(0),d(1))}finally{c(!1)}}else g("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.")}),[p]);(0,t.useEffect)((()=>{const e=parseInt(p.page,10);isNaN(e)||e===o||l(e)}),[p.page,o]),(0,t.useEffect)((()=>{b()}),[b]);const f=async e=>{m(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await _()({path:`/${t}/documents/${e}`,method:"DELETE"}),await b(),m(!1),!0}catch(e){return g(e.message||"Error deleting document"),m(!1),!1}},y=async(e,t)=>{try{const{apiNamespace:s}=window.documentRepositorySettings,a=await _()({path:`/${s}/documents/${e}`,method:"PUT",data:t});return await b(),a}catch(e){return g(e.message||"Error updating document"),null}};return{documents:e,totalDocuments:a,currentPage:o,totalPages:i,isLoading:r,isDeleting:u,error:h,searchParams:p,setSearchParams:v,fetchDocuments:b,deleteDocument:f,updateDocument:y,bulkUpdateDocuments:async(e,t)=>{try{for(const s of e)await y(s,t);return await b(),!0}catch(e){return g(e.message||"Error performing bulk update"),!1}},bulkDeleteDocuments:async e=>{try{for(const t of e)await f(t);return!0}catch(e){return g(e.message||"Error performing bulk delete"),!1}}}})(),[T,P]=(0,t.useState)([]);(0,t.useEffect)((()=>{(async()=>{try{o(!0),i(null),r("Initializing");const e=new Promise(((e,t)=>{setTimeout((()=>{t(new Error((0,a.__)("Loading document repository timed out. Please refresh the page.","bcgov-design-system")))}),1e4)})),t=window.documentRepositorySettings;if(!t?.apiRoot||!t?.apiNamespace||!t?.nonce)throw new Error((0,a.__)("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.","bcgov-design-system"));await Promise.race([(async()=>{r("Fetching metadata fields");const e=await fetch(`${t.apiRoot}${t.apiNamespace}/metadata-fields`,{headers:{"X-WP-Nonce":t.nonce}});if(!e.ok){let t;try{const s=await e.json();t=s.message||s.error}catch(s){t=e.statusText}throw new Error((0,a.__)("Failed to fetch metadata fields: ","bcgov-design-system")+t)}const s=await e.json();u(s),r("Loading documents"),await C()})(),e])}catch(e){i(e.message||(0,a.__)("Failed to initialize document repository","bcgov-design-system"))}finally{o(!1)}})()}),[C]);const[B,R]=(0,t.useState)([]),[O,A]=(0,t.useState)(0),[I,z]=(0,t.useState)(0),U=()=>{C(),h(!1),b(null),R([]),A(0)},L=async e=>{try{if(!e.type.includes("pdf")&&!e.name.toLowerCase().endsWith(".pdf"))throw new Error("Only PDF files are allowed");const t=new FormData;t.append("file",e),t.append("title",e.name.split(".")[0]);const s=window.documentRepositorySettings?.nonce;if(!s)throw new Error("Security token not found");const a=new window.XMLHttpRequest,n=new Promise(((n,o)=>{a.open("POST",`${window.documentRepositorySettings.apiRoot}${window.documentRepositorySettings.apiNamespace}/documents`),a.setRequestHeader("X-WP-Nonce",s),a.upload.onprogress=e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);z(t)}},a.onload=()=>{if(a.status>=200&&a.status<300)try{const e=JSON.parse(a.responseText);n(e)}catch(t){o(new Error(`Error uploading "${e.name}": Server returned invalid response`))}else{let t;try{const e=JSON.parse(a.responseText);t=e.message||e.error||a.statusText}catch(e){t=a.statusText||"Server error"}o(new Error(`Error uploading "${e.name}": ${t}`))}},a.onerror=()=>{o(new Error(`Network error while uploading "${e.name}". Please check your connection and try again.`))},a.send(t)}));await n,U()}catch(e){throw i(e.message||"Failed to upload file"),e}},$=l||M;return(0,t.useEffect)((()=>{if($){const e=setTimeout((()=>{i(null)}),3e3);return()=>clearTimeout(e)}}),[$]),e?(0,n.jsxs)("div",{className:"dswp-document-repository-loading",children:[(0,n.jsx)(s.Spinner,{}),(0,n.jsxs)("p",{children:[d,"..."]}),(0,n.jsx)("p",{className:"loading-description",children:(0,a.__)("Loading document repository…","bcgov-design-system")})]}):(0,n.jsx)(j,{children:(0,n.jsxs)("div",{className:"dswp-document-repository",children:[$&&(0,n.jsx)(s.Notice,{status:"error",isDismissible:!0,onDismiss:()=>i(null),className:"document-repository-error",children:(0,n.jsx)("p",{children:$})}),(0,n.jsx)(f,{documents:x||[],isLoading:k,totalItems:S,currentPage:w||1,totalPages:N||1,onPageChange:async e=>{try{i(null),F((t=>({...t,page:e})))}catch(e){i(e.message||(0,a.__)("Failed to change page","bcgov-design-system")),F((e=>({...e,page:w})))}},onDelete:D,isDeleting:E,selectedDocuments:T||[],onSelectDocument:e=>{try{const t=T.includes(e)?T.filter((t=>t!==e)):[...T,e];P(t)}catch(e){i((0,a.__)("Failed to select document","bcgov-design-system"))}},onSelectAll:e=>{try{P(e?x.map((e=>e.id)):[])}catch(e){i((0,a.__)("Failed to select documents","bcgov-design-system"))}},metadataFields:c||[],onUploadSuccess:U,onFileDrop:L}),m&&v&&(0,n.jsxs)(s.Modal,{title:B.length>1?(0,a.__)("Upload Documents","bcgov-design-system"):(0,a.__)("Upload Document","bcgov-design-system"),onRequestClose:()=>p(!0),className:"document-upload-modal",children:[(0,n.jsxs)("div",{className:"upload-progress-info",children:[B.length>1&&(0,n.jsxs)("p",{className:"upload-queue-status",children:[(0,a.__)("Uploading file","bcgov-design-system")," ",O+1," ",(0,a.__)("of","bcgov-design-system")," ",B.length]}),(0,n.jsx)("div",{className:"progress-bar",children:(0,n.jsx)("div",{className:"progress-bar-fill",style:{width:`${I}%`}})})]}),(0,n.jsx)(y,{metadataFields:c,onUploadSuccess:U,selectedFile:v,modalMode:!0,onFileDrop:L})]}),g&&(0,n.jsxs)(s.Modal,{title:(0,a.__)("Cancel Upload","bcgov-design-system"),onRequestClose:()=>p(!1),className:"cancel-upload-modal",children:[(0,n.jsx)("p",{children:(0,a.__)("Are you sure you want to cancel the remaining uploads?","bcgov-design-system")}),(0,n.jsxs)("div",{className:"modal-actions",children:[(0,n.jsx)(s.Button,{className:"doc-repo-button",onClick:()=>p(!1),children:(0,a.__)("Continue Upload","bcgov-design-system")}),(0,n.jsx)(s.Button,{className:"doc-repo-button",isDestructive:!0,onClick:()=>{h(!1),b(null),R([]),A(0),p(!1)},children:(0,a.__)("Cancel Upload","bcgov-design-system")})]})]})]})})};document.addEventListener("DOMContentLoaded",(()=>{try{const e=document.getElementById("dswp-document-repository-app");if(e)(0,t.createRoot)(e).render((0,n.jsx)(S,{}));else{const e=document.createElement("div");e.style.color="red",e.style.padding="20px",e.style.border="1px solid red",e.innerHTML="<strong>Error:</strong> Document Repository container not found. Check console for details.",document.body.prepend(e)}}catch(e){const t=document.createElement("div");t.style.color="red",t.style.padding="20px",t.style.border="1px solid red",t.innerHTML=`<strong>Error:</strong> Failed to initialize Document Repository app: ${e.message}`,document.body.prepend(t)}}))})();