(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,n=window.wp.components,l=window.wp.i18n;class s extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,t.createElement)("div",{className:"error-boundary"},(0,t.createElement)("h2",null,(0,l.__)("Something went wrong.","bcgov-design-system")),(0,t.createElement)("p",null,(0,l.__)("Please try refreshing the page.","bcgov-design-system")),!1)}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}const o=s;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,t.createElement)("div",{className:"document-table-row error",role:"row"},(0,t.createElement)("div",{className:"document-table-cell",role:"cell",style:{textAlign:"center"}},(0,l.__)("Error rendering document row.","bcgov-design-system"),!1))}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}function c({document:e,isSelected:a,onSelect:s,onDelete:o,onEdit:r,isDeleting:c,metadataFields:i,isSpreadsheetMode:d,bulkEditedMetadata:m,onMetadataChange:u,formatFileSize:g}){return(0,t.createElement)("div",{className:"document-table-row",role:"row"},(0,t.createElement)("div",{className:"document-table-cell",role:"cell","aria-label":(0,l.__)("Select document","bcgov-design-system")},(0,t.createElement)(n.CheckboxControl,{checked:a,onChange:()=>s(e.id)})),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.title||e.filename),i.map((a=>(0,t.createElement)("div",{key:a.id,className:"document-table-cell metadata-column",role:"cell","aria-label":(0,l.sprintf)(/* translators: %s: field label */ /* translators: %s: field label */
(0,l.__)("Edit %s","bcgov-design-system"),a.label)},(a=>{if(!d){const t=e.metadata&&e.metadata[a.id]?e.metadata[a.id]:"";if("taxonomy"===a.type&&t){const e=(a.options||[]).find((e=>"string"==typeof e?e===t:(e.value||e.id)===t));if(e)return"string"==typeof e?e:e.label||e.name}return t||"—"}const s=m[e.id]?.[a.id]||"";if("taxonomy"===a.type){const o=(a.options||[]).map((e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.value||e.id}));return(0,t.createElement)(n.SelectControl,{value:s,options:[{label:(0,l.__)("Select…","bcgov-design-system"),value:""},...o],onChange:t=>u(e.id,a.id,t)})}return(0,t.createElement)(n.TextControl,{type:"date"===a.type?"date":"text",value:s,onChange:t=>u(e.id,a.id,t),className:"metadata-input"})})(a)))),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.metadata&&e.metadata.document_file_size?g(e.metadata.document_file_size):"—"),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.metadata&&e.metadata.document_file_type?e.metadata.document_file_type:"—"),(0,t.createElement)("div",{className:"document-table-cell actions",role:"cell","aria-label":(0,l.__)("Document actions","bcgov-design-system")},!d&&(0,t.createElement)("div",{className:"action-buttons"},(0,t.createElement)(n.Button,{onClick:()=>window.open(e.metadata.document_file_url,"_blank"),className:"doc-repo-button icon-button table-action-button",title:(0,l.__)("Download","bcgov-design-system"),"aria-label":(0,l.__)("Download","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"}))),(0,t.createElement)(n.Button,{onClick:()=>r(e),className:"doc-repo-button icon-button table-action-button",title:(0,l.__)("Edit Metadata","bcgov-design-system"),"aria-label":(0,l.__)("Edit Metadata","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"}))),(0,t.createElement)(n.Button,{onClick:()=>o(e),className:"doc-repo-button icon-button table-action-button",title:(0,l.__)("Delete","bcgov-design-system"),"aria-label":(0,l.__)("Delete","bcgov-design-system"),disabled:c},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",fill:"currentColor"}))))))}function i({documents:e,selectedDocuments:a,onSelectDocument:s,onSelectAll:o,onDelete:i,onEdit:d,isDeleting:m,metadataFields:u,isSpreadsheetMode:g,bulkEditedMetadata:p,onMetadataChange:h,formatFileSize:E}){const v=e.length>0&&a.length===e.length;return(0,t.createElement)("div",{className:"document-table",role:"table"},(0,t.createElement)("div",{className:"document-table-header",role:"rowgroup"},(0,t.createElement)("div",{className:"document-table-row",role:"row"},(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,t.createElement)(n.CheckboxControl,{checked:v,onChange:o})),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,l.__)("Title","bcgov-design-system")),u.map((e=>(0,t.createElement)("div",{key:e.id,className:"document-table-cell header metadata-column",role:"columnheader"},e.label))),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,l.__)("Size","bcgov-design-system")),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,l.__)("Type","bcgov-design-system")),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,l.__)("Actions","bcgov-design-system")))),(0,t.createElement)("div",{className:"document-table-body",role:"rowgroup"},e.map((e=>(0,t.createElement)(r,{key:e.id},(0,t.createElement)(c,{document:e,isSelected:a.includes(e.id),onSelect:s,onDelete:i,onEdit:d,isDeleting:m,metadataFields:u,isSpreadsheetMode:g,bulkEditedMetadata:p,onMetadataChange:h,formatFileSize:E}))))))}const d=({documents:e=[],selectedDocuments:s=[],onSelectDocument:o,onSelectAll:r,onDelete:c,onEdit:i,isDeleting:d=!1,metadataFields:m=[],isSpreadsheetMode:u=!1,bulkEditedMetadata:g={},onMetadataChange:p,formatFileSize:h})=>{const{containerRef:E,visibleRange:v,totalHeight:b,topOffset:_}=(({itemHeight:e=60,itemCount:t=0,overscan:n=5,initialHeight:l=500})=>{const s=(0,a.useRef)(null),[o,r]=(0,a.useState)({start:0,end:Math.min(20,t)}),[c,i]=(0,a.useState)(l),d=(0,a.useCallback)((()=>{if(!s.current)return;const a=s.current,l=a.scrollTop,o=a.clientHeight;let c=Math.floor(l/e);c=Math.max(0,c-n);let i=Math.ceil((l+o)/e);i=Math.min(t,i+n),r({start:c,end:i})}),[t,e,n]),m=(0,a.useCallback)((()=>{d()}),[d]);(0,a.useEffect)((()=>{const e=s.current;if(!e)return;i(e.clientHeight),d(),e.addEventListener("scroll",m);const t=()=>{e&&(i(e.clientHeight),d())};return window.addEventListener("resize",t),()=>{e.removeEventListener("scroll",m),window.removeEventListener("resize",t)}}),[d,m]),(0,a.useEffect)((()=>{d()}),[t,d]);const u=t*e,g=o.start*e;return{containerRef:s,visibleRange:o,containerHeight:c,totalHeight:u,topOffset:g,handleScroll:m,calculateVisibleRange:d}})({itemHeight:60,itemCount:e.length,overscan:5,initialHeight:500}),y=(0,a.useCallback)((e=>{r(e)}),[r]),f=e.length>0&&s.length===e.length,S=s.length>0&&s.length<e.length,w=e.slice(v.start,v.end);return(0,t.createElement)("div",{className:"virtualized-table-container",ref:E},(0,t.createElement)("table",{className:"document-table"},(0,t.createElement)("thead",{className:"document-table__header"},(0,t.createElement)("tr",null,(0,t.createElement)("th",{className:"checkbox-column"},(0,t.createElement)(n.CheckboxControl,{checked:f,indeterminate:S,onChange:y})),(0,t.createElement)("th",null,(0,l.__)("Document","bcgov-design-system")),m.map((e=>(0,t.createElement)("th",{key:e.id},e.label))),(0,t.createElement)("th",null,(0,l.__)("File Size","bcgov-design-system")),(0,t.createElement)("th",{className:"actions-column"},(0,l.__)("Actions","bcgov-design-system")))),(0,t.createElement)("tbody",{style:{height:`${b}px`,position:"relative"}},0===e.length?(0,t.createElement)("tr",null,(0,t.createElement)("td",{colSpan:m.length+4,className:"empty-state"},(0,l.__)("No documents found.","bcgov-design-system"))):(0,t.createElement)("div",{className:"virtualized-rows",style:{position:"absolute",top:`${_}px`,width:"100%"}},w.map((e=>{const a=s.includes(e.id),r=a?"document-table__row document-table__row--selected":"document-table__row";return(0,t.createElement)("tr",{key:e.id,className:r},(0,t.createElement)("td",{className:"checkbox-column"},(0,t.createElement)(n.CheckboxControl,{checked:a,onChange:()=>o(e.id)})),(0,t.createElement)("td",null,(0,t.createElement)("div",{className:"document-cell"},(0,t.createElement)("span",{className:"document-cell__title"},e.title||e.filename||(0,l.__)("Untitled","bcgov-design-system")),(0,t.createElement)("span",{className:"document-cell__metadata"},e.filename||e.title||(0,l.__)("No filename","bcgov-design-system")))),m.map((a=>{var n;const l=e.metadata?.[a.id]||"",s=u&&null!==(n=g[e.id]?.[a.id])&&void 0!==n?n:l;return u?(0,t.createElement)("td",{key:a.id,className:"editable-cell"},(0,t.createElement)("input",{type:"text",className:"editable-field",value:s,onChange:t=>p(e.id,a.id,t.target.value)})):(0,t.createElement)("td",{key:a.id},s)})),(0,t.createElement)("td",{className:"file-size"},e.metadata?.document_file_size?h(parseInt(e.metadata.document_file_size)):(0,l.__)("N/A","bcgov-design-system")),(0,t.createElement)("td",{className:"actions-column"},(0,t.createElement)("div",{className:"action-buttons"},(0,t.createElement)("button",{className:"edit-button",onClick:()=>i(e),title:(0,l.__)("Edit Document","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},(0,t.createElement)("path",{fill:"currentColor",d:"M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"}))),e.metadata?.document_file_url&&(0,t.createElement)("a",{href:e.metadata.document_file_url,target:"_blank",rel:"noopener noreferrer",className:"view-button",title:(0,l.__)("View Document","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},(0,t.createElement)("path",{fill:"currentColor",d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"}))),(0,t.createElement)("button",{className:"delete-button",onClick:()=>c(e),disabled:d,title:(0,l.__)("Delete Document","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},(0,t.createElement)("path",{fill:"currentColor",d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}))))))}))))))},m=({uploadingFiles:e,showUploadFeedback:n,onClose:s})=>{const o=e.filter((e=>"success"===e.status)).length,r=e.filter((e=>"error"===e.status)).length,c=e.filter((e=>"uploading"===e.status)).length,i=e.filter((e=>"processing"===e.status)).length,d=e.some((e=>e.isPlaceholder));return(0,a.useEffect)((()=>{if(n&&0===c&&0===i&&!d&&e.length>0){const e=setTimeout((()=>{s()}),3e3);return()=>clearTimeout(e)}}),[n,c,i,d,s,e.length]),n&&0!==e.length?(0,t.createElement)("div",{className:"upload-feedback"},(0,t.createElement)("div",{className:"upload-feedback-header"},(0,t.createElement)("div",{className:"upload-feedback-title"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})),(0,l.__)("Document Upload Status","bcgov-design-system")),(0,t.createElement)("button",{className:"upload-feedback-close",onClick:()=>{0===c&&0===i&&s()}},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})))),(0,t.createElement)("div",{className:"upload-feedback-items"},e.map((e=>(0,t.createElement)("div",{key:e.id,className:`upload-feedback-item ${e.status} ${e.isPlaceholder?"placeholder":""}`},(0,t.createElement)("span",{className:"upload-feedback-item-name"},e.name),"processing"===e.status&&(0,t.createElement)(t.Fragment,null,(0,l.__)("Processing…","bcgov-design-system")),"uploading"===e.status&&(0,t.createElement)(t.Fragment,null,(0,l.__)("Uploading…","bcgov-design-system")),"success"===e.status&&(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})),"error"===e.status&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})),e.error&&(0,t.createElement)("span",{className:"upload-feedback-item-error"},e.error)))))),(0,t.createElement)("div",{className:"upload-feedback-summary"},d?(0,t.createElement)("div",{className:"processing"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})),(0,l.__)("Preparing files…","bcgov-design-system")):(0,t.createElement)(t.Fragment,null,i>0&&(0,t.createElement)("div",{className:"processing"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})),(0,l.sprintf)(/* translators: %d: number of files being processed */ /* translators: %d: number of files being processed */
(0,l.__)("Processing %d files…","bcgov-design-system"),i)),c>0&&(0,t.createElement)("div",{className:"uploading"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})),(0,l.sprintf)(/* translators: %d: number of files being uploaded */ /* translators: %d: number of files being uploaded */
(0,l.__)("Uploading %d files…","bcgov-design-system"),c)),o>0&&(0,t.createElement)("div",{className:"success"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})),(0,l.sprintf)(/* translators: %d: number of files that were successfully uploaded */ /* translators: %d: number of files that were successfully uploaded */
(0,l.__)("%d files uploaded successfully","bcgov-design-system"),o)),r>0&&(0,t.createElement)("div",{className:"error"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})),(0,l.sprintf)(/* translators: %d: number of files that failed to upload */ /* translators: %d: number of files that failed to upload */
(0,l.__)("%d files failed to upload","bcgov-design-system"),r))))):null},u=({title:e,isOpen:s,onClose:o,onSave:r,isSaving:c=!1,isDisabled:i=!1,saveButtonText:d,saveButtonClassName:m="doc-repo-button save-button",children:u})=>{const g=(0,a.useCallback)((e=>{e&&(e.preventDefault(),e.stopPropagation()),o()}),[o]),p=(0,a.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),r()}),[r]);return s?(0,t.createElement)(n.Modal,{title:e,onRequestClose:g,className:"metadata-edit-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0},(0,t.createElement)("form",{onSubmit:p,className:"metadata-edit-form"},u,(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(n.Button,{onClick:g,disabled:c,className:"doc-repo-button cancel-button"},(0,l.__)("Cancel","bcgov-design-system")),(0,t.createElement)(n.Button,{type:"submit",isBusy:c,disabled:c||i,className:m},d||(0,l.__)("Save Changes","bcgov-design-system"))))):null},g=({onFilesSelected:e,acceptMimeTypes:s="application/pdf"})=>{const[o,r]=(0,a.useState)(!1),c=(0,a.useRef)(null),i=(0,a.useRef)(null);(0,a.useEffect)((()=>()=>{i.current&&clearTimeout(i.current)}),[]);const d=(0,a.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),r(!0)}),[]),m=(0,a.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),o||r(!0)}),[o]),u=(0,a.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),!e.currentTarget.contains(e.relatedTarget)&&(i.current=setTimeout((()=>{r(!1)}),50))}),[]),g=(0,a.useCallback)((t=>{t.preventDefault(),t.stopPropagation(),r(!1);const a=t.dataTransfer.files;a&&a.length>0&&e(Array.from(a))}),[e]),p=(0,a.useCallback)((t=>{const a=Array.from(t.target.files);a.length>0&&e(a)}),[e]),h=(0,a.useCallback)((e=>{e&&e.stopPropagation(),c.current&&c.current.click()}),[c]),E=(0,a.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),h())}),[h]);return(0,t.createElement)("div",{className:"upload-area__container "+(o?"upload-area__container--drag-active":""),onDragEnter:d,onDragOver:m,onDragLeave:u,onDrop:g,onClick:h,onKeyDown:E,tabIndex:"0",role:"button","aria-label":(0,l.__)("Click or drag files to upload","bcgov-design-system")},(0,t.createElement)("input",{type:"file",ref:c,className:"upload-area__file-input",onChange:p,multiple:!0,accept:s,"aria-hidden":"true"}),(0,t.createElement)("div",{className:"upload-area__content"},(0,t.createElement)("div",{className:"upload-area__icon"},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"48",height:"48"},(0,t.createElement)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z",fill:"currentColor"}))),(0,t.createElement)("h3",{className:"upload-area__text"},(0,l.__)("Drag & Drop or Click to Upload","bcgov-design-system")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,l.__)("Upload PDF documents to the repository","bcgov-design-system")),(0,t.createElement)(n.Button,{className:"upload-area__button",onClick:e=>{e.stopPropagation(),h()}},(0,l.__)("Choose Files","bcgov-design-system"))))},p=({currentPage:e,totalPages:a,onPageChange:s})=>a<=1?null:(0,t.createElement)("div",{className:"pagination"},(0,t.createElement)(n.Button,{onClick:()=>s(e-1),disabled:1===e},(0,l.__)("Previous","bcgov-design-system")),(0,t.createElement)("span",{className:"page-info"},(0,l.sprintf)(/* translators: %1$d: current page number, %2$d: total number of pages */ /* translators: %1$d: current page number, %2$d: total number of pages */
(0,l.__)("Page %1$d of %2$d","bcgov-design-system"),e,a)),(0,t.createElement)(n.Button,{onClick:()=>s(e+1),disabled:e===a},(0,l.__)("Next","bcgov-design-system"))),h=({failedOperations:e,onRetryAll:a})=>0===e.length?null:(0,t.createElement)(n.Notice,{status:"warning",isDismissible:!1,className:"retry-notice"},(0,t.createElement)("p",null,(0,l.sprintf)(/* translators: %d: number of failed operations */ /* translators: %d: number of failed operations */
(0,l.__)("There are %d failed operations that can be retried.","bcgov-design-system"),e.length)),(0,t.createElement)(n.Button,{variant:"secondary",onClick:a},(0,l.__)("Retry All","bcgov-design-system"))),E=window.wp.apiFetch;var v=e.n(E);const b=(e,t)=>{switch(t.type){case"SET_EDITING_DOCUMENT":return{...e,editingMetadata:t.payload,editedValues:t.initialValues||{},errors:{}};case"CLEAR_EDITING_DOCUMENT":return{...e,editingMetadata:null,editedValues:{},errors:{}};case"UPDATE_EDITED_VALUES":return{...e,editedValues:{...e.editedValues,...t.payload}};case"SET_ERRORS":return{...e,errors:t.payload};case"SET_IS_SAVING":return{...e,isSaving:t.payload};case"ENTER_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!0,bulkEditedMetadata:t.initialBulkValues||{},hasMetadataChanges:!1};case"EXIT_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1};case"UPDATE_BULK_METADATA":return{...e,bulkEditedMetadata:{...e.bulkEditedMetadata,[t.documentId]:{...e.bulkEditedMetadata[t.documentId],[t.fieldId]:t.value}},hasMetadataChanges:t.hasChanges};case"SET_IS_SAVING_BULK":return{...e,isSavingBulk:t.payload};case"CLEAR_BULK_CHANGES":return{...e,bulkEditedMetadata:{},hasMetadataChanges:!1};default:return e}},_=({documents:e=[],currentPage:s=1,totalPages:r=1,onPageChange:c,onDelete:E,isDeleting:_=!1,selectedDocuments:y=[],onSelectDocument:f,onSelectAll:S,onFileDrop:w,onDocumentsUpdate:N,metadataFields:C=[]})=>{const D=(0,a.useMemo)((()=>e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}),[]),k=(0,a.useMemo)((()=>{const e=window.documentRepositorySettings;return e?.apiNamespace||"wp/v2"}),[]),{showNotification:M}=(()=>{const[e,t]=(0,a.useState)(null);return{notice:e,showNotification:(0,a.useCallback)(((e,a,n=3e3)=>{t({status:e,message:a}),n>0&&setTimeout((()=>t(null)),n)}),[]),clearNotification:(0,a.useCallback)((()=>{t(null)}),[])}})(),{failedOperations:T,handleOperationError:F,retryAllOperations:P}=(({onShowNotification:e})=>{const[t,n]=(0,a.useState)([]),[s,o]=(0,a.useState)({}),r=(0,a.useCallback)(((t,a,s,r={})=>{const{addToRetryQueue:c=!0,showNotice:i=!0,customMessage:d=null}=r;if(c&&(n((e=>[...e,{type:t,documentId:a,error:s}])),o((e=>({...e,[a]:(e[a]||0)+1})))),i&&e){const t=d||s.message||s.data?.message||(0,l.__)("An unknown error occurred.","bcgov-design-system");e("error",a?(0,l.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,l.__)("Operation failed for document %1$d: %2$s","bcgov-design-system"),a,t):t)}}),[e]),c=(0,a.useCallback)((async(t,a)=>{if(s[t.documentId]>=3)e("error",(0,l.sprintf)(/* translators: %1$d: document ID */ /* translators: %1$d: document ID */
(0,l.__)("Maximum retry attempts reached for document %1$d","bcgov-design-system"),t.documentId));else try{const e=a[t.type];if(!e)return{error:`Unknown operation type: ${t.type}`};await e(t.documentId),n((e=>e.filter((e=>!(e.type===t.type&&e.documentId===t.documentId)))))}catch(e){r(t.type,t.documentId,e)}}),[s,r,e]),i=(0,a.useCallback)((e=>{t.forEach((t=>c(t,e)))}),[t,c]);return{failedOperations:t,handleOperationError:r,retryOperation:c,retryAllOperations:i}})({onShowNotification:M}),{deleteDocument:x,bulkDeleteConfirmOpen:B,isMultiDeleting:R,setDeleteDocument:I,handleBulkDelete:O,handleSingleDelete:z,openBulkDeleteConfirm:A,closeBulkDeleteConfirm:U}=(({onDelete:e,onSelectAll:t,onShowNotification:n,onError:s})=>{const[o,r]=(0,a.useState)(null),[c,i]=(0,a.useState)(!1),[d,m]=(0,a.useState)(!1),u=(0,a.useCallback)((async a=>{if(a&&0!==a.length){m(!0);try{await Promise.all(a.map((t=>e(t)))),i(!1),t(!1),n&&n("success",(0,l.__)("Selected documents were deleted successfully.","bcgov-design-system"))}catch(e){s&&s("bulk-delete",null,e,{addToRetryQueue:!1,customMessage:(0,l.__)("Error deleting one or more documents.","bcgov-design-system")})}finally{m(!1)}}}),[e,t,n,s]),g=(0,a.useCallback)((async t=>{try{await e(t),r(null),n&&n("success",(0,l.__)("Document deleted successfully.","bcgov-design-system"))}catch(e){s&&s("delete",t,e,{customMessage:(0,l.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,l.__)("Error deleting document %1$d: %2$s","bcgov-design-system"),t,e.message||(0,l.__)("An unknown error occurred","bcgov-design-system"))})}}),[e,n,s]),p=(0,a.useCallback)((()=>{i(!0)}),[]),h=(0,a.useCallback)((()=>{i(!1)}),[]);return{deleteDocument:o,bulkDeleteConfirmOpen:c,isMultiDeleting:d,setDeleteDocument:r,handleBulkDelete:u,handleSingleDelete:g,openBulkDeleteConfirm:p,closeBulkDeleteConfirm:h}})({onDelete:E,onSelectAll:S,onShowNotification:M,onError:F}),{editingMetadata:L,editedValues:$,errors:V,isSaving:H,hasMetadataChanged:j,handleEditMetadata:q,updateEditedField:G,handleSaveMetadata:K,isSpreadsheetMode:W,hasMetadataChanges:X,bulkEditedMetadata:J,isSavingBulk:Q,handleMetadataChange:Y,toggleSpreadsheetMode:Z,handleSaveBulkChanges:ee,localDocuments:te}=(({documents:e=[],metadataFields:t=[],apiNamespace:n,onUpdateDocuments:s,onError:o,onShowNotification:r})=>{const[c,i]=(0,a.useReducer)(b,{editingMetadata:null,editedValues:{},errors:{},isSaving:!1,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1,isSavingBulk:!1}),[d,m]=(0,a.useState)(e);(0,a.useEffect)((()=>{m(e)}),[e]);const u=(0,a.useCallback)((()=>{const{editingMetadata:e,editedValues:a}=c;return!!e&&t.some((t=>(e.metadata?.[t.id]||"")!==(a[t.id]||"")))}),[c,t]),g=(0,a.useCallback)((e=>{if(!e)return void i({type:"CLEAR_EDITING_DOCUMENT"});const a={...e,upload_date:e.date||e.upload_date||e.metadata?.upload_date},n={};t.forEach((t=>{var a;n[t.id]=null!==(a=e.metadata?.[t.id])&&void 0!==a?a:""})),i({type:"SET_EDITING_DOCUMENT",payload:a,initialValues:n})}),[t]),p=(0,a.useCallback)(((e,t,a)=>{const n={...c.bulkEditedMetadata,[e]:{...c.bulkEditedMetadata[e],[t]:a}},l=Object.entries(n).some((([e,t])=>{const a=d.find((t=>t.id===parseInt(e)));return!!a&&Object.entries(t).some((([e,t])=>{const n=a.metadata?.[e]||"";return String(n)!==String(t)}))}));i({type:"UPDATE_BULK_METADATA",documentId:e,fieldId:t,value:a,hasChanges:l}),m((n=>n.map((n=>n.id===e?{...n,metadata:{...n.metadata,[t]:a}}:n))))}),[d,c.bulkEditedMetadata,i]),h=(0,a.useCallback)(((e,t)=>{i({type:"UPDATE_EDITED_VALUES",payload:{[e]:t}})}),[i]),E=(0,a.useCallback)((async()=>{const{editingMetadata:e,editedValues:t}=c;if(e){i({type:"SET_IS_SAVING",payload:!0});try{await v()({path:`/${n}/documents/${e.id}/metadata`,method:"POST",data:t}),m((a=>a.map((a=>a.id===e.id?{...a,metadata:{...a.metadata,...t}}:a)))),"function"==typeof s&&s(d.map((a=>a.id===e.id?{...a,metadata:{...a.metadata,...t}}:a))),i({type:"CLEAR_EDITING_DOCUMENT"}),r&&r("success",(0,l.__)("Document metadata updated successfully","bcgov-design-system"))}catch(t){t.data?.errors&&i({type:"SET_ERRORS",payload:t.data.errors}),o&&o("metadata",e.id,t,{customMessage:t.data?.message||(0,l.__)("Failed to update metadata","bcgov-design-system")})}finally{i({type:"SET_IS_SAVING",payload:!1})}}}),[c,n,d,s,r,o,i]),_=(0,a.useCallback)((e=>{if(e){const e={};d.forEach((t=>{e[t.id]={...t.metadata||{}}})),i({type:"ENTER_SPREADSHEET_MODE",initialBulkValues:e})}else i({type:"EXIT_SPREADSHEET_MODE"})}),[d]),y=(0,a.useCallback)((async()=>{const{bulkEditedMetadata:e}=c;i({type:"SET_IS_SAVING_BULK",payload:!0});try{const t=(await Promise.allSettled(Object.entries(e).map((([e,t])=>v()({path:`/${n}/documents/${e}/metadata`,method:"POST",data:t}))))).map(((t,a)=>({result:t,docId:Object.keys(e)[a]}))).filter((({result:e})=>"rejected"===e.status));t.length>0?(t.forEach((({result:e,docId:t})=>{o&&o("metadata",t,e.reason,{showNotice:!1})})),r&&r("warning",(0,l.sprintf)(/* translators: %1$d: number of failed updates, %2$d: total number of updates */ /* translators: %1$d: number of failed updates, %2$d: total number of updates */
(0,l.__)("%1$d of %2$d metadata updates failed. You can retry the failed operations.","bcgov-design-system"),t.length,Object.keys(e).length),0)):(r&&r("success",(0,l.__)("All metadata changes saved successfully.","bcgov-design-system")),i({type:"CLEAR_BULK_CHANGES"}),i({type:"EXIT_SPREADSHEET_MODE"}))}catch(e){o&&o("bulk-metadata",null,e)}finally{i({type:"SET_IS_SAVING_BULK",payload:!1})}}),[c,n,o,r]);return{editingMetadata:c.editingMetadata,editedValues:c.editedValues,errors:c.errors,isSaving:c.isSaving,hasMetadataChanged:u,handleEditMetadata:g,updateEditedField:h,handleSaveMetadata:E,isSpreadsheetMode:c.isSpreadsheetMode,hasMetadataChanges:c.hasMetadataChanges,bulkEditedMetadata:c.bulkEditedMetadata,isSavingBulk:c.isSavingBulk,handleMetadataChange:p,toggleSpreadsheetMode:_,handleSaveBulkChanges:y,localDocuments:d}})({documents:e,metadataFields:C,apiNamespace:k,onUpdateDocuments:N,onError:F,onShowNotification:M}),{uploadingFiles:ae,showUploadFeedback:ne,handleFiles:le,closeUploadFeedback:se}=(({onFileDrop:e,onShowNotification:t,onError:n})=>{const[s,o]=(0,a.useState)([]),[r,c]=(0,a.useState)(!1);return{uploadingFiles:s,showUploadFeedback:r,handleFiles:(0,a.useCallback)((a=>{if(c(!0),!a||0===a.length)return t&&t("error",(0,l.__)("No files were selected for upload.","bcgov-design-system")),void c(!1);o([{id:"placeholder",name:(0,l.sprintf)(/* translators: %d: number of files being prepared */ /* translators: %d: number of files being prepared */
(0,l.__)("Preparing %d files…","bcgov-design-system"),a.length),status:"processing",error:null,isPlaceholder:!0}]);const s=a.map((e=>({id:Math.random().toString(36).substr(2,9),name:e.name,originalFile:e,status:"processing",error:null})));o(s);const r=[],i=[];a.forEach((e=>{"application/pdf"===e.type||e.name.toLowerCase().endsWith(".pdf")?r.push(e):i.push(e)})),o((e=>e.map((e=>{const t=a.find((t=>t.name===e.name)),n=t&&("application/pdf"===t.type||t.name.toLowerCase().endsWith(".pdf"));return{...e,status:n?"uploading":"error",error:n?null:(0,l.__)("Not a PDF file. Only PDF files are allowed.","bcgov-design-system")}})))),i.length>0&&t&&t("warning",(0,l.sprintf)(/* translators: %1$d: number of skipped files, %2$d: total number of files */ /* translators: %1$d: number of skipped files, %2$d: total number of files */
(0,l.__)("%1$d of %2$d files were skipped because they are not PDFs.","bcgov-design-system"),i.length,a.length)),0!==r.length&&r.forEach((t=>{e(t).then((()=>{o((e=>e.map((e=>e.name===t.name?{...e,status:"success"}:e))))})).catch((e=>{o((a=>a.map((a=>a.name===t.name?{...a,status:"error",error:e.message||(0,l.__)("Upload failed. Please try again.","bcgov-design-system")}:a)))),n&&n("upload",t.name,e,{addToRetryQueue:!1,customMessage:(0,l.sprintf)(/* translators: %1$s: file name, %2$s: error message */ /* translators: %1$s: file name, %2$s: error message */
(0,l.__)('Error uploading "%1$s": %2$s',"bcgov-design-system"),t.name,e.message||(0,l.__)("Upload failed","bcgov-design-system"))})}))}))}),[e,t,n]),closeUploadFeedback:(0,a.useCallback)((()=>{c(!1),o([])}),[])}})({onFileDrop:w,onShowNotification:M,onError:F}),oe=(0,a.useCallback)((()=>{P({delete:E,metadata:K})}),[E,K,P]),re=(0,a.useMemo)((()=>({documents:te,selectedDocuments:y,onSelectDocument:f,onSelectAll:S,onDelete:I,onEdit:q,isDeleting:_,metadataFields:C,isSpreadsheetMode:W,bulkEditedMetadata:J,onMetadataChange:Y,formatFileSize:D})),[te,y,f,S,_,C,W,J,q,Y,D,I]);return(0,t.createElement)(o,null,(0,t.createElement)("div",{className:"document-list"},(0,t.createElement)(h,{failedOperations:T,onRetryAll:oe}),(0,t.createElement)("div",{className:"document-list__actions"},(0,t.createElement)("div",{className:"document-list__left-actions"}),(0,t.createElement)("div",{className:"document-list__right-actions"},(0,t.createElement)(g,{onFilesSelected:e=>{le(e)}}))),(0,t.createElement)("div",{className:"document-list__table-actions"},(0,t.createElement)("div",{className:"action-buttons-container"},(0,t.createElement)(n.Button,{className:"doc-repo-button spreadsheet-toggle"+(W?" isPressed":""),onClick:()=>Z(!W),isPressed:W},W?(0,l.__)("Exit Spreadsheet Mode","bcgov-design-system"):(0,l.__)("Enter Spreadsheet Mode","bcgov-design-system")),W&&X&&(0,t.createElement)(n.Button,{className:"doc-repo-button save-button",onClick:ee,isBusy:Q,disabled:Q},Q?(0,l.__)("Saving…","bcgov-design-system"):(0,l.__)("Save Changes","bcgov-design-system")),y.length>0&&(0,t.createElement)(n.Button,{className:"doc-repo-button delete-button bulk-delete-button",onClick:A,disabled:R},(0,l.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,l.__)("Delete Selected (%d)","bcgov-design-system"),y.length)))),e.length>=50?(0,t.createElement)(d,{...re}):(0,t.createElement)(i,{...re}),(0,t.createElement)(p,{currentPage:s,totalPages:r,onPageChange:c}),ne&&(0,t.createElement)(m,{uploadingFiles:ae,showUploadFeedback:ne,onClose:se}),x&&(0,t.createElement)(u,{title:(0,l.__)("Delete Document","bcgov-design-system"),isOpen:!!x,onClose:()=>I(null),onSave:()=>z(x.id),isSaving:_,isDisabled:!1,saveButtonText:_?(0,l.__)("Deleting…","bcgov-design-system"):(0,l.__)("Delete","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button"},(0,t.createElement)("div",{className:"delete-confirmation-content"},(0,t.createElement)("div",{className:"delete-warning"},(0,l.__)("Are you sure you want to delete this document? This action cannot be undone.","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-delete"},(0,t.createElement)("h4",null,(0,l.__)("Document to be deleted:","bcgov-design-system")),(0,t.createElement)("ul",null,(0,t.createElement)("li",null,x.title))))),B&&(0,t.createElement)(u,{title:(0,l.__)("Delete Selected Documents","bcgov-design-system"),isOpen:B,onClose:U,onSave:()=>O(y),isSaving:R,isDisabled:!1,saveButtonText:R?(0,l.__)("Deleting…","bcgov-design-system"):(0,l.__)("Delete Selected","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button"},(0,t.createElement)("div",{className:"delete-confirmation-content"},(0,t.createElement)("div",{className:"delete-warning"},(0,l.__)("Are you sure you want to delete the selected documents? This action cannot be undone.","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-delete"},(0,t.createElement)("h4",null,(0,l.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,l.__)("Documents to be deleted (%d):","bcgov-design-system"),y.length)),(0,t.createElement)("ul",null,te.filter((e=>y.includes(e.id))).map((e=>(0,t.createElement)("li",{key:e.id},e.title))))))),L&&(0,t.createElement)(u,{title:(0,l.__)("Edit Document Metadata","bcgov-design-system"),isOpen:!!L,onClose:()=>q(null),onSave:K,isSaving:H,isDisabled:!j,saveButtonText:H?(0,l.__)("Saving…","bcgov-design-system"):(0,l.__)("Save Changes","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"editable-metadata"},C.map((e=>(0,t.createElement)("div",{key:e.id,className:"metadata-field"},(0,t.createElement)("label",{htmlFor:e.id},e.label),"taxonomy"===e.type?(0,t.createElement)(n.SelectControl,{id:e.id,value:$[e.id]||"",options:[{label:(0,l.__)("Select…","bcgov-design-system"),value:""},...(e.options||[]).map((e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.value||e.id}))],onChange:t=>G(e.id,t)}):(0,t.createElement)(n.TextControl,{id:e.id,type:"date"===e.type?"date":"text",value:$[e.id]||"",onChange:t=>G(e.id,t)}),V[e.id]&&(0,t.createElement)("div",{className:"metadata-error"},V[e.id]))))),(0,t.createElement)("div",{className:"non-editable-metadata"},(0,t.createElement)("h3",null,(0,l.__)("Document Information","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-filename"},(0,l.__)("Filename","bcgov-design-system")),(0,t.createElement)("div",{id:"document-filename",className:"field-value"},(L.metadata?.document_file_name||L.filename||L.title||"").replace(/\.pdf$/i,"")||(0,l.__)("Not available","bcgov-design-system"))),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-file-type"},(0,l.__)("File Type","bcgov-design-system")),(0,t.createElement)("div",{id:"document-file-type",className:"field-value"},L.metadata?.document_file_type||"PDF")),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-file-size"},(0,l.__)("File Size","bcgov-design-system")),(0,t.createElement)("div",{id:"document-file-size",className:"field-value"},L.metadata?.document_file_size?D(parseInt(L.metadata.document_file_size)):(0,l.__)("Not available","bcgov-design-system")))))))},y=({metadataFields:e,onUploadSuccess:s,selectedFile:o=null,modalMode:r=!1})=>{const[c,i]=(0,a.useState)(o),[d,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)(0),[p,h]=(0,a.useState)(null),[E,v]=(0,a.useState)(!1),[b,_]=(0,a.useState)(!1),y=(0,a.useRef)(null),f=(0,a.useRef)(null),[S,w]=(0,a.useState)(o?o.name.split(".")[0]:""),[N,C]=(0,a.useState)({}),{apiNamespace:D,maxFileSize:k,allowedMimeTypes:M}=window.documentRepositorySettings,T=(0,a.useCallback)((e=>{if(!e)return!1;if(e.size>k){const t=`File "${e.name}" is too large (${(e.size/1048576).toFixed(2)} MB). Maximum allowed size is ${(k/1048576).toFixed(2)} MB.`;return h(t),!1}const t=e.name.split(".").pop().toLowerCase(),a=Object.keys(M);if(!a.includes(t)){const t=`File "${e.name}" has an invalid file type. Allowed types are: ${a.join(", ")}`;return h(t),!1}return h(null),!0}),[k,M]),F=(0,a.useCallback)((e=>{if(!e)return!1;if(T(e)){i(e);const t=e.name.includes(".")?e.name.substring(0,e.name.lastIndexOf(".")):e.name;return w(t),!0}return!1}),[T]);(0,a.useEffect)((()=>{if(o&&(w(o.name.replace(/\.[^/.]+$/,"")),!T(o)))return{error:"Initial file validation failed, but still setting file for UI"}}),[o,T]),(0,a.useEffect)((()=>{r&&!c&&o&&i(o)}),[r,o,c]);const P=e=>{const t=e.target.files[0];F(t)},x=()=>{y.current&&y.current.click()},B=(e,t)=>{C((a=>({...a,[e]:t})))},R=async()=>{if(!c)return void h("Please select a file to upload.");if(!T(c))return;m(!0),h(null),g(0);const e=new FormData;e.append("file",c),e.append("title",S),e.append("_wpnonce",window.documentRepositorySettings.nonce);const t={...N,document_repository:!0},a=JSON.stringify(t);e.append("metadata",a);try{const t=await fetch(`${window.documentRepositorySettings.apiRoot}${D}/documents`,{method:"POST",headers:{"X-WP-Nonce":window.documentRepositorySettings.nonce},body:e});if(!t.ok){const e=await t.json();throw new Error(e.message||"Upload failed")}const a=await t.json();v(!0),m(!1),s&&s(a.document),r||(i(null),w(""),C({}))}catch(e){h(e.message||"Failed to upload file. Please try again."),m(!1)}},I=e=>{const{id:a,label:s,type:o,options:r,required:c}=e;switch(o){case"text":return(0,t.createElement)(n.TextControl,{key:a,label:s,value:N[a]||"",onChange:e=>B(a,e),required:c});case"date":return(0,t.createElement)(n.TextControl,{key:a,label:s,type:"date",value:N[a]||"",onChange:e=>B(a,e),required:c});case"taxonomy":return(0,t.createElement)(n.SelectControl,{key:a,label:s,value:N[a]||"",options:[{label:(0,l.__)("Select…","bcgov-design-system"),value:""},...(r||[]).map((e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.value||e.id}))],onChange:e=>B(a,e),required:c});default:return null}},O=()=>d?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.Spinner,null),(0,l.__)("Uploading…","bcgov-design-system")):(0,l.__)("Upload Document","bcgov-design-system");return r?(0,t.createElement)("div",{className:"document-uploader-modal"},p&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!0,onRemove:()=>h(null)},p),E&&(0,t.createElement)(n.Notice,{status:"success",isDismissible:!0,onRemove:()=>v(!1)},(0,l.__)("Document uploaded successfully!","bcgov-design-system")),(0,t.createElement)("div",{className:"selected-file-info"},c?(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"File:")," ",c.name," (",Math.round(c.size/1024)," KB)"):o?(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"File:")," ",o.name," (",Math.round(o.size/1024)," KB)"):(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"Warning:")," No file selected")),(0,t.createElement)(n.TextControl,{label:(0,l.__)("Document Title","bcgov-design-system"),value:S,onChange:w,disabled:d,required:!0}),(0,t.createElement)("h4",null,(0,l.__)("Document Metadata","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-fields modal-layout"},e.map(I)),d&&(0,t.createElement)("div",{className:"upload-progress"},(0,t.createElement)("progress",{value:u,max:"100"}),(0,t.createElement)("p",null,u,"%"," ",(0,l.__)("Uploaded","bcgov-design-system"))),(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(n.Button,{isPrimary:!0,onClick:R,disabled:!c&&!o||!S||d},O()))):(0,t.createElement)(n.Card,{className:"document-uploader"},(0,t.createElement)(n.CardHeader,null,(0,t.createElement)("h3",null,(0,l.__)("Upload Document","bcgov-design-system"))),(0,t.createElement)(n.CardBody,null,(0,t.createElement)(t.Fragment,null,E&&(0,t.createElement)(n.Notice,{status:"success",isDismissible:!0,onRemove:()=>v(!1)},(0,l.__)("Document uploaded successfully!","bcgov-design-system")),p&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!0,onRemove:()=>h(null)},p),!r&&!c&&(0,t.createElement)("div",{className:"upload-area__container "+(b?"upload-area__container--drag-active":""),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),_(!0)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),_(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation();const t=f.current.getBoundingClientRect();(e.clientX<t.left||e.clientX>=t.right||e.clientY<t.top||e.clientY>=t.bottom)&&_(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),_(!1);const t=Array.from(e.dataTransfer.files);var a;t.length>0&&(a=t[0],F(a))},onClick:x,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||x()},role:"button",tabIndex:"0",ref:f},(0,t.createElement)("input",{type:"file",ref:y,onChange:P,className:"upload-area__file-input",accept:Object.values(M).join(",")}),(0,t.createElement)("div",{className:"upload-area__content"},(0,t.createElement)("div",{className:"upload-area__icon"},(0,t.createElement)("svg",{viewBox:"0 0 64 64",width:"64",height:"64"},(0,t.createElement)("path",{d:"M32 16v24M20 28l12-12 12 12",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.createElement)("path",{d:"M16 48h32M12 20v28c0 2.2 1.8 4 4 4h32c2.2 0 4-1.8 4-4V20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}))),(0,t.createElement)("div",{className:"upload-area__text"},(0,t.createElement)("p",{className:"upload-area__text-primary"},b?(0,l.__)("Drop file here","bcgov-design-system"):(0,l.__)("Drag & drop your file here or click to browse","bcgov-design-system")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,l.__)("Accepted file types:","bcgov-design-system")," ",Object.keys(M).join(", ")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,l.__)("Maximum file size:","bcgov-design-system")," ",Math.round(k/1048576)," ","MB")))),r&&!c&&(0,t.createElement)("div",{className:"document-uploader-file-select"},(0,t.createElement)(n.FormFileUpload,{accept:Object.values(M).join(","),onChange:P},(0,l.__)("Select a different file","bcgov-design-system"))),c&&(0,t.createElement)("div",{className:"selected-file-container"},(0,t.createElement)("div",{className:"selected-file"},(0,t.createElement)("span",{className:"file-name"},c.name),(0,t.createElement)("button",{type:"button",className:"remove-file",onClick:()=>i(null)},"✕")),!r&&(0,t.createElement)(n.FormFileUpload,{accept:Object.values(M).join(","),onChange:P},(0,l.__)("Select a different file","bcgov-design-system"))),d&&(0,t.createElement)("div",{className:"upload-progress"},(0,t.createElement)("progress",{value:u,max:"100"}),(0,t.createElement)("p",null,u,"%"," ",(0,l.__)("Uploaded","bcgov-design-system"))),(0,t.createElement)(n.TextControl,{label:(0,l.__)("Document Title","bcgov-design-system"),value:S,onChange:w,disabled:d,required:!0}),(0,t.createElement)("h4",null,(0,l.__)("Document Metadata","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-fields "+(r?"modal-layout":"")},e.map(I)))),(0,t.createElement)(n.CardFooter,null,(0,t.createElement)("div",{className:"card-actions"},(0,t.createElement)(n.Button,{isPrimary:!0,onClick:R,disabled:!c||!S||d},O()))))};class f extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}render(){return this.state.hasError?(0,t.createElement)("div",{className:"dswp-document-repository-error"},(0,t.createElement)(n.Notice,{status:"error",isDismissible:!1},(0,t.createElement)("h2",null,(0,l.__)("Something went wrong in the Document Repository","bcgov-design-system")),(0,t.createElement)("p",null,this.state.error&&this.state.error.toString()),(0,t.createElement)("details",{style:{whiteSpace:"pre-wrap"}},this.state.errorInfo&&this.state.errorInfo.componentStack))):this.props.children}}const S=f,w=()=>{const[e,s]=(0,a.useState)(!0),[o,r]=(0,a.useState)(null),[c,i]=(0,a.useState)("Initializing"),[d,m]=(0,a.useState)([]),[u,g]=(0,a.useState)(!1),[p,h]=(0,a.useState)(!1),[E,b]=(0,a.useState)(null),{documents:f,totalDocuments:w,currentPage:N,totalPages:C,fetchDocuments:D,deleteDocument:k,isDeleting:M,isLoading:T,error:F,setSearchParams:P}=(()=>{const[e,t]=(0,a.useState)([]),[n,l]=(0,a.useState)(0),[s,o]=(0,a.useState)(1),[r,c]=(0,a.useState)(1),[i,d]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[g,p]=(0,a.useState)(null),[h,E]=(0,a.useState)({page:1,per_page:window.documentRepositorySettings?.perPage||20,orderby:"date",order:"DESC"}),b=(0,a.useCallback)((async()=>{if(window.documentRepositorySettings?.apiNamespace){d(!0),p(null);try{const{apiNamespace:e}=window.documentRepositorySettings,a=new URLSearchParams;Object.entries(h).forEach((([e,t])=>{t&&a.append(e,t)}));const n=new Promise(((e,t)=>{setTimeout((()=>{t(new Error("Document fetch request timed out. Please try again."))}),5e3)})),s=await Promise.race([v()({path:`/${e}/documents?${a.toString()}`}),n]);if(!s||"object"!=typeof s)throw new Error("Invalid response from server");const r=Array.isArray(s.documents)?s.documents.filter((e=>e&&"object"==typeof e&&e.id)):[];t(r),l(s.total||0),o(s.current_page||1),c(s.total_pages||1),0===r.length&&h.page>1&&E((e=>({...e,page:1})))}catch(e){p(e.message||"Error loading documents"),1===h.page&&(t([]),l(0),c(1))}finally{d(!1)}}else p("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.")}),[h]);(0,a.useEffect)((()=>{const e=parseInt(h.page,10);isNaN(e)||e===s||o(e)}),[h.page,s]),(0,a.useEffect)((()=>{b()}),[b]);const _=async e=>{u(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await v()({path:`/${t}/documents/${e}`,method:"DELETE"}),await b(),u(!1),!0}catch(e){return p(e.message||"Error deleting document"),u(!1),!1}},y=async(e,t)=>{try{const{apiNamespace:a}=window.documentRepositorySettings,n=await v()({path:`/${a}/documents/${e}`,method:"PUT",data:t});return await b(),n}catch(e){return p(e.message||"Error updating document"),null}};return{documents:e,totalDocuments:n,currentPage:s,totalPages:r,isLoading:i,isDeleting:m,error:g,searchParams:h,setSearchParams:E,fetchDocuments:b,deleteDocument:_,updateDocument:y,bulkUpdateDocuments:async(e,t)=>{try{for(const a of e)await y(a,t);return await b(),!0}catch(e){return p(e.message||"Error performing bulk update"),!1}},bulkDeleteDocuments:async e=>{try{for(const t of e)await _(t);return!0}catch(e){return p(e.message||"Error performing bulk delete"),!1}}}})(),[x,B]=(0,a.useState)([]);(0,a.useEffect)((()=>{(async()=>{try{s(!0),r(null),i("Initializing");const e=new Promise(((e,t)=>{setTimeout((()=>{t(new Error((0,l.__)("Loading document repository timed out. Please refresh the page.","bcgov-design-system")))}),1e4)})),t=window.documentRepositorySettings;if(!t?.apiRoot||!t?.apiNamespace||!t?.nonce)throw new Error((0,l.__)("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.","bcgov-design-system"));await Promise.race([(async()=>{i("Fetching metadata fields");const e=await fetch(`${t.apiRoot}${t.apiNamespace}/metadata-fields`,{headers:{"X-WP-Nonce":t.nonce}});if(!e.ok){let t;try{const a=await e.json();t=a.message||a.error}catch(a){t=e.statusText}throw new Error((0,l.__)("Failed to fetch metadata fields: ","bcgov-design-system")+t)}const a=await e.json();m(a),i("Loading documents"),await D()})(),e])}catch(e){r(e.message||(0,l.__)("Failed to initialize document repository","bcgov-design-system"))}finally{s(!1)}})()}),[D]);const[R,I]=(0,a.useState)([]),[O,z]=(0,a.useState)(0),[A,U]=(0,a.useState)(0),L=(0,a.useMemo)((()=>{let e;return(...t)=>{clearTimeout(e),e=setTimeout((()=>D(...t)),1e3)}}),[D]),$=()=>{L(),g(!1),b(null),I([]),z(0)},V=async e=>{try{if(!e.type.includes("pdf")&&!e.name.toLowerCase().endsWith(".pdf"))throw new Error("Only PDF files are allowed");const t=new FormData;t.append("file",e),t.append("title",e.name.split(".")[0]);const a=window.documentRepositorySettings?.nonce;if(!a)throw new Error("Security token not found");const n=new window.XMLHttpRequest,l=new Promise(((l,s)=>{n.open("POST",`${window.documentRepositorySettings.apiRoot}${window.documentRepositorySettings.apiNamespace}/documents`),n.setRequestHeader("X-WP-Nonce",a),n.upload.onprogress=e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);U(t)}},n.onload=()=>{if(n.status>=200&&n.status<300)try{const e=JSON.parse(n.responseText);l(e)}catch(t){s(new Error(`Error uploading "${e.name}": Server returned invalid response`))}else{let t;try{const e=JSON.parse(n.responseText);t=e.message||e.error||n.statusText}catch(e){t=n.statusText||"Server error"}s(new Error(`Error uploading "${e.name}": ${t}`))}},n.onerror=()=>{s(new Error(`Network error while uploading "${e.name}". Please check your connection and try again.`))},n.send(t)}));await l,$()}catch(e){throw r(e.message||"Failed to upload file"),e}},H=o||F;return(0,a.useEffect)((()=>{if(H){const e=setTimeout((()=>{r(null)}),3e3);return()=>clearTimeout(e)}}),[H]),e?(0,t.createElement)("div",{className:"dswp-document-repository-loading"},(0,t.createElement)(n.Spinner,null),(0,t.createElement)("p",null,c,"..."),(0,t.createElement)("p",{className:"loading-description"},(0,l.__)("Loading document repository…","bcgov-design-system"))):(0,t.createElement)(S,null,(0,t.createElement)("div",{className:"dswp-document-repository"},H&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!0,onDismiss:()=>r(null),className:"document-repository-error"},(0,t.createElement)("p",null,H)),(0,t.createElement)(_,{documents:f||[],isLoading:T,totalItems:w,currentPage:N||1,totalPages:C||1,onPageChange:async e=>{try{r(null),P((t=>({...t,page:e})))}catch(e){r(e.message||(0,l.__)("Failed to change page","bcgov-design-system")),P((e=>({...e,page:N})))}},onDelete:k,isDeleting:M,selectedDocuments:x||[],onSelectDocument:e=>{try{const t=x.includes(e)?x.filter((t=>t!==e)):[...x,e];B(t)}catch(e){r((0,l.__)("Failed to select document","bcgov-design-system"))}},onSelectAll:e=>{try{B(e?f.map((e=>e.id)):[])}catch(e){r((0,l.__)("Failed to select documents","bcgov-design-system"))}},metadataFields:d||[],onUploadSuccess:$,onFileDrop:V}),u&&E&&(0,t.createElement)(n.Modal,{title:R.length>1?(0,l.__)("Upload Documents","bcgov-design-system"):(0,l.__)("Upload Document","bcgov-design-system"),onRequestClose:()=>h(!0),className:"document-upload-modal"},(0,t.createElement)("div",{className:"upload-progress-info"},R.length>1&&(0,t.createElement)("p",{className:"upload-queue-status"},(0,l.__)("Uploading file","bcgov-design-system")," ",O+1," ",(0,l.__)("of","bcgov-design-system")," ",R.length),(0,t.createElement)("div",{className:"progress-bar"},(0,t.createElement)("div",{className:"progress-bar-fill",style:{width:`${A}%`}}))),(0,t.createElement)(y,{metadataFields:d,onUploadSuccess:$,selectedFile:E,modalMode:!0,onFileDrop:V})),p&&(0,t.createElement)(n.Modal,{title:(0,l.__)("Cancel Upload","bcgov-design-system"),onRequestClose:()=>h(!1),className:"cancel-upload-modal"},(0,t.createElement)("p",null,(0,l.__)("Are you sure you want to cancel the remaining uploads?","bcgov-design-system")),(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(n.Button,{className:"doc-repo-button",onClick:()=>h(!1)},(0,l.__)("Continue Upload","bcgov-design-system")),(0,t.createElement)(n.Button,{className:"doc-repo-button",isDestructive:!0,onClick:()=>{g(!1),b(null),I([]),z(0),h(!1)}},(0,l.__)("Cancel Upload","bcgov-design-system"))))))};document.addEventListener("DOMContentLoaded",(()=>{try{const e=document.getElementById("dswp-document-repository-app");if(e)(0,a.createRoot)(e).render((0,t.createElement)(w,null));else{const e=document.createElement("div");e.style.color="red",e.style.padding="20px",e.style.border="1px solid red",e.innerHTML="<strong>Error:</strong> Document Repository container not found. Check console for details.",document.body.prepend(e)}}catch(e){const t=document.createElement("div");t.style.color="red",t.style.padding="20px",t.style.border="1px solid red",t.innerHTML=`<strong>Error:</strong> Failed to initialize Document Repository app: ${e.message}`,document.body.prepend(t)}}))})();