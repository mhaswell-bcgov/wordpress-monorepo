{"version":3,"file":"in-page-nav.js","mappings":"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","sources":["webpack://design-system-wordpress-plugin/./src/Bcgov/DesignSystemPlugin/InPageNav/styles.css","webpack://design-system-wordpress-plugin/webpack/bootstrap","webpack://design-system-wordpress-plugin/webpack/runtime/make namespace object","webpack://design-system-wordpress-plugin/./src/Bcgov/DesignSystemPlugin/InPageNav/index.js"],"sourcesContent":["// extracted by mini-css-extract-plugin\nexport {};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// Import the styles for the in-page navigation\nimport './styles.css';  \n\n/**\n * In-page Navigation Script\n * Creates a navigation menu that dynamically links to headings on the page\n * Based on USWDS in-page navigation component with custom modifications\n */\ndocument.addEventListener('DOMContentLoaded', () => {\n    \n    /**\n     * Safely escapes HTML special characters to prevent XSS attacks\n     * @param {string} str - The string to escape\n     * @returns {string} - The escaped HTML string\n     */\n    const escapeHTML = (str) => {\n        const div = document.createElement('div');\n        div.appendChild(document.createTextNode(str));\n        return div.innerHTML;\n    };\n\n    /**\n     * Creates and inserts the in-page navigation into the DOM\n     */\n    const createNavigation = () => {\n        // Fix the mainContent selector line\n        const mainContent = document.querySelector('#main-content') || document.querySelector('main') || document.querySelector('.content-area');\n        if (!mainContent) {\n            console.log('No main content found');\n            return;\n        }\n\n        // Only select H2 and H3 elements that have an ID attribute\n        const headings = Array.from(mainContent.querySelectorAll('h2[id], h3[id]'));\n        console.log('Found headings:', headings); // Debug log\n\n        // Don't create navigation if there are no valid headings\n        if (headings.length < 2) {\n            console.log('Not enough headings found, minimum required: 2'); // Debug log\n            return;\n        }\n\n        // Create the navigation container as an aside element\n        const asideElement = document.createElement('aside');\n        asideElement.className = 'dswp-in-page-nav';\n        \n        // Create the navigation HTML structure\n        const navHTML = `\n            <div class=\"nav-title\">\n                <h4>On this page</h4>\n            </div>\n            <ul class=\"nav-links\">\n                ${headings\n                    .map(heading => `\n                        <li>\n                            <a href=\"#${heading.id}\" data-heading-id=\"${heading.id}\">${escapeHTML(heading.textContent)}</a>\n                        </li>\n                    `)\n                    .join('')}\n            </ul>\n        `;\n        \n        // Insert the navigation HTML\n        asideElement.innerHTML = navHTML;\n        console.log('Navigation HTML created:', asideElement); // Debug log\n\n        // Replace the Intersection Observer code with this new scroll-based highlighting\n        const updateActiveLink = () => {\n            const isMobile = window.innerWidth <= 1800;\n            const navHeight = isMobile ? asideElement.offsetHeight + 8 : 0;\n            \n            // Get the viewport height and calculate the scroll threshold\n            const viewportHeight = window.innerHeight;\n            const scrollThreshold = navHeight + (viewportHeight * 0.2);\n            \n            // Get total scroll height and current scroll position\n            const scrollHeight = document.documentElement.scrollHeight;\n            const scrollPosition = window.scrollY + viewportHeight;\n            \n            // Find the current heading by checking positions\n            const currentHeading = headings.reduce((closest, heading) => {\n                const headingRect = heading.getBoundingClientRect();\n                const headingTop = headingRect.top;\n                \n                // Special case for last heading or near bottom of page\n                if (scrollPosition >= scrollHeight - 50) {\n                    // If we're at the bottom, select the last heading\n                    return headings[headings.length - 1];\n                }\n                \n                // Check if heading is in the threshold area, accounting for nav height\n                if (headingTop < scrollThreshold && headingTop > -headingRect.height) {\n                    if (!closest || headingTop > closest.getBoundingClientRect().top) {\n                        return heading;\n                    }\n                }\n                return closest;\n            }, null);\n\n            // Update active state\n            if (currentHeading) {\n                const activeLink = asideElement.querySelector(`a[data-heading-id=\"${currentHeading.id}\"]`);\n                asideElement.querySelectorAll('a').forEach(link => {\n                    link.classList.remove('dswp-current');\n                });\n                if (activeLink) {\n                    activeLink.classList.add('dswp-current');\n                }\n            }\n        };\n\n        // Add scroll event listener with throttling for performance\n        let scrollTimeout;\n        window.addEventListener('scroll', () => {\n            if (scrollTimeout) {\n                window.cancelAnimationFrame(scrollTimeout);\n            }\n            scrollTimeout = window.requestAnimationFrame(() => {\n                updateActiveLink();\n            });\n        });\n\n        // Also update on page load\n        updateActiveLink();\n\n        // Add smooth scrolling\n        asideElement.querySelectorAll('a').forEach(link => {\n            link.addEventListener('click', event => {\n                event.preventDefault();\n                const targetId = link.getAttribute('href').substring(1);\n                const targetElement = document.getElementById(targetId);\n                \n                if (targetElement) {\n                    const isMobile = window.innerWidth <= 1800;\n                    const navHeight = isMobile ? asideElement.offsetHeight + 8 : 0;\n                    const extraPadding = 60; // Reduced from 100 to 60 pixels\n                    \n                    // Calculate position with adjusted offset\n                    const targetPosition = targetElement.getBoundingClientRect().top + window.scrollY - navHeight - extraPadding;\n                    \n                    window.scrollTo({\n                        top: targetPosition,\n                        behavior: 'smooth'\n                    });\n                    \n                    history.pushState(null, null, `#${targetId}`);\n                }\n            });\n        });\n\n        // Insert the in-page navigation at the beginning of main content\n        mainContent.insertBefore(asideElement, mainContent.firstChild);\n        console.log('Navigation inserted into DOM'); // Debug log\n    };\n\n    // Initialize the navigation when the DOM is fully loaded\n    createNavigation();\n});"],"names":["document","addEventListener","escapeHTML","str","div","createElement","appendChild","createTextNode","innerHTML","createNavigation","mainContent","querySelector","console","log","headings","Array","from","querySelectorAll","length","asideElement","className","navHTML","map","heading","id","textContent","join","updateActiveLink","isMobile","window","innerWidth","navHeight","offsetHeight","viewportHeight","innerHeight","scrollThreshold","scrollHeight","documentElement","scrollPosition","scrollY","currentHeading","reduce","closest","headingRect","getBoundingClientRect","headingTop","top","height","activeLink","forEach","link","classList","remove","add","scrollTimeout","cancelAnimationFrame","requestAnimationFrame","event","preventDefault","targetId","getAttribute","substring","targetElement","getElementById","extraPadding","targetPosition","scrollTo","behavior","history","pushState","insertBefore","firstChild"],"sourceRoot":""}