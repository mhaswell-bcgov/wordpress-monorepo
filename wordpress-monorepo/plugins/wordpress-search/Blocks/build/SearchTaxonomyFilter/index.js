(()=>{"use strict";const e=window.wp.blocks,t=window.wp.i18n,s=window.wp.data,o=window.wp.components,n=window.wp.blockEditor,r=window.wp.element,i=window.ReactJSXRuntime,a=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"wordpress-search/search-taxonomy-filter","version":"1.0.0","title":"Taxonomy Filter","category":"search","icon":"filter","description":"A modular search taxonomy filter block that connects to the search page template","attributes":{"selectedTaxonomies":{"type":"array","default":[],"items":{"type":"string"}}},"editorScript":"file:./index.js","editorStyle":"file:./index.css","viewStyle":"file:./view.css","viewScript":"file:./view.js","render":"file:./render.php","style":"file:./view.css","dependencies":["wp-api-fetch","wp-url","wp-components","wp-element","wp-i18n"]}');(0,e.registerBlockType)(a.name,{...a,edit:function({attributes:e,setAttributes:a}){const{selectedTaxonomy:l,selectedTaxonomies:c}=e;let p;p=void 0!==c?c:l?[l]:[],(0,r.useEffect)(()=>{l&&void 0===c&&a({selectedTaxonomies:[l]})},[l,c,a]);const{taxonomies:d}=(0,s.useSelect)(e=>{const{getTaxonomies:t}=e("core");return{taxonomies:t({per_page:-1,context:"view"})||[]}},[]),m=(0,r.useMemo)(()=>{const e=new Map;for(const t of d||[]){if(!t?.name)continue;const s=t.types||t.object_type||[];for(const o of s)e.has(o)||e.set(o,new Set),e.get(o).add(t.name.toLowerCase())}return e},[d]),h=(0,r.useMemo)(()=>(d||[]).filter(e=>{if(!e||!e.name)return!1;const t=e.types||e.object_type||[],s="category"===e.name,o="post_tag"===e.name,n=1===t.length&&"post"===t[0];if((s||o)&&n)return!1;if(s&&t.length>0)for(const e of t)if("post"!==e){const t=m.get(e);if(t){const s=e.toLowerCase()+"_";for(const e of t)if(e.startsWith(s)||e.includes("_category"))return!1}}return!0}).map(e=>{if(!e.types||0===e.types.length){const t=e.object_type||[];if(0===t.length)return null;e.types=t}const s=e.labels?.singular_name||e.name||(0,t.__)("Unknown","wordpress-search"),o=e.types[0];return{label:`${o.charAt(0).toUpperCase()+o.slice(1)}: ${s.charAt(0).toUpperCase()+s.slice(1)}`,value:`${e.types[0]}:${e.name}`}}).filter(Boolean),[d,m]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.InspectorControls,{children:(0,i.jsx)(o.PanelBody,{title:(0,t.__)("Taxonomy Filter Settings","wordpress-search"),initialOpen:!0,children:(0,i.jsxs)("div",{className:"taxonomy-filter-settings",children:[(0,i.jsx)("p",{className:"taxonomy-filter-settings__description",children:(0,t.__)("Select one or more taxonomies to create filters for:","wordpress-search")}),h.length>0?h.map(e=>(0,i.jsx)(o.CheckboxControl,{label:e.label,checked:p.includes(e.value),onChange:t=>((e,t)=>{const s=t?[...p,e]:p.filter(t=>t!==e);a({selectedTaxonomies:s})})(e.value,t)},e.value)):(0,i.jsx)("p",{className:"taxonomy-filter-settings__loading",children:(0,t.__)("Loading taxonomies…","wordpress-search")})]})})}),(0,i.jsx)("div",{...(0,n.useBlockProps)(),children:(0,i.jsxs)("div",{className:"taxonomy-filter-preview",children:[(0,i.jsxs)("div",{className:"taxonomy-filter-preview__header",children:[(0,i.jsx)("h4",{children:(0,t.__)("Taxonomy Filter","wordpress-search")}),(0,i.jsx)("p",{className:"taxonomy-filter-preview__description",children:p&&p.length>0?(0,t.__)("Selected:","wordpress-search")+" "+(p&&0!==p.length?p.map(e=>{const s=h.find(t=>t.value===e);return s?s.label:(0,t.__)("Unknown taxonomy","wordpress-search")}).join(", "):(0,t.__)("No taxonomies selected","wordpress-search")):(0,t.__)("Configure taxonomies in the block settings →","wordpress-search")})]}),p&&p.length>0&&(0,i.jsx)("div",{className:"taxonomy-filter-preview__content",children:(0,i.jsx)("div",{className:"taxonomy-filter-preview__placeholder",children:(0,i.jsx)("p",{children:(0,t.__)("Filter options will appear here on the frontend","wordpress-search")})})})]})})]})},deprecated:[{attributes:{selectedTaxonomy:{type:"string",default:""}},save:()=>null,migrate:e=>{const{selectedTaxonomy:t}=e||{};return{selectedTaxonomies:t?[t]:[]}}}]})})();